<!doctype html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <base href="/" />
  <title>Knowledge Garden - IoT Learning Platform</title>
  <meta name="description" content="Leading IoT education platform with hands-on tutorials, projects, and collaborative learning experiences." />
  <meta name="keywords" content="IoT, Arduino, Raspberry Pi, Sensors, Programming, Engineering, Education, Tutorials" />
  <meta name="author" content="Knowledge Garden Team" />
  <meta property="og:title" content="Knowledge Garden - IoT Learning Platform" />
  <meta property="og:description" content="Master IoT development through hands-on tutorials and collaborative projects" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://knowledgegarden.edu" />
  <link rel="icon" type="image/png" href="logo.jpeg" />
  <link rel="preload" as="image" href="logo.jpeg" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script>window.API_BASE='';</script>
  <style>
    :root{ 
      --brand-navy:#0A2E6F; 
      --brand-mag:#FF2B7A; 
      --brand-light-blue:#E0F2FE;
      --brand-light-pink:#FFF1F5;
      --bg:#fff; 
      --panel:#fff; 
      --text:#1f2937; 
      --muted:#6b7280; 
      --border:#e5e7eb;
      --success:#10b981;
      --warning:#f59e0b;
      --error:#ef4444;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
    }

    * {
      box-sizing: border-box;
    }

    html,body{
      margin:0;
      height:100%;
      background:var(--bg);
      color:var(--text);
      font-family:'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      line-height: 1.6;
      scroll-behavior: smooth;
    }

    /* Enhanced background with animated gradients */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      z-index:-2;
      background:
        radial-gradient(1200px 700px at 85% -5%, rgba(10,46,111,.12), transparent 65%),
        radial-gradient(900px 600px at -5% 25%, rgba(255,43,122,.08), transparent 55%),
        radial-gradient(600px 400px at 50% 100%, rgba(10,46,111,.06), transparent 40%),
        var(--bg);
      animation: backgroundShift 20s ease-in-out infinite;
    }

    @keyframes backgroundShift {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    body::after{
      content:"";
      position:fixed;
      inset:0;
      z-index:-1;
      opacity:.05;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1600 900'%3E%3Cg fill='none' stroke='%23FF2B7A' stroke-width='1' stroke-dasharray='8 12'%3E%3Cpath d='M40 140h260l40 40h240l40-40h260'/%3E%3C/g%3E%3Cg fill='none' stroke='%230A2E6F' stroke-width='1' stroke-dasharray='8 12'%3E%3Cpath d='M0 220h280l50 50h240l50-50h280'/%3E%3C/g%3E%3C/svg%3E");
      background-size:cover;
    }

    /* Enhanced accessibility */
    .skip-link{
      position:absolute;
      left:-9999px;
      top:auto;
      width:1px;
      height:1px;
      overflow:hidden;
      background: var(--brand-navy);
      color: white;
      padding: 8px 16px;
      text-decoration: none;
      border-radius: 4px;
      font-weight: 600;
    }
    .skip-link:focus{
      position:fixed;
      left:16px;
      top:16px;
      width:auto;
      height:auto;
      z-index:9999;
      box-shadow: var(--shadow-lg);
    }

    /* Enhanced navigation */
    .nav{
      background:rgba(255,255,255,0.95);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--border);
      position:sticky;
      top:0;
      z-index:50;
      padding:16px 24px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      transition: all 0.3s ease;
    }

    .nav.scrolled {
      background: rgba(255,255,255,0.98);
      box-shadow: var(--shadow-md);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      font-weight:800;
      color:var(--brand-navy);
      font-size: 20px;
      text-decoration: none;
    }

    .brand img {
      width: 45px;
      height: 45px;
      border-radius: 12px;
      object-fit: cover;
      box-shadow: var(--shadow-sm);
      transition: transform 0.3s ease;
    }

    .brand:hover img {
      transform: scale(1.05);
    }

    .nav-links{
      display:flex;
      gap:32px;
      align-items:center;
      font-weight:600;
      font-size:16px;
    }

    .nav-links a{
      position:relative;
      padding:8px 0;
      color:var(--brand-navy);
      text-decoration:none;
      transition: color 0.3s ease;
    }

    .nav-links a::after{
      content:"";
      position:absolute;
      left:0;
      bottom:-2px;
      width:100%;
      height:3px;
      background:linear-gradient(90deg, var(--brand-mag), var(--brand-navy));
      transform:scaleX(0);
      transform-origin:right;
      transition:transform .3s ease;
      border-radius: 2px;
    }

    .nav-links a:hover::after, .nav-links a.active::after{
      transform:scaleX(1);
      transform-origin:left;
    }

    .nav-links a:hover {
      color: var(--brand-mag);
    }

    /* Mobile navigation */
    .nav-toggle {
      display: none;
      flex-direction: column;
      cursor: pointer;
      padding: 4px;
    }

    .nav-toggle span {
      width: 25px;
      height: 3px;
      background: var(--brand-navy);
      margin: 3px 0;
      transition: 0.3s;
      border-radius: 2px;
    }

    @media (max-width: 768px) {
      .nav-links {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: rgba(255,255,255,0.98);
        backdrop-filter: blur(10px);
        flex-direction: column;
        padding: 20px;
        border-bottom: 1px solid var(--border);
        box-shadow: var(--shadow-lg);
      }

      .nav-links.active {
        display: flex;
      }

      .nav-toggle {
        display: flex;
      }
    }

    /* Enhanced hero section */
    .hero{
      padding:80px 24px;
      max-width:1400px;
      margin:auto;
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:60px;
      align-items:center;
      min-height: 80vh;
    }

    .hero h1{
      font-size:clamp(36px,5vw,64px);
      color:var(--brand-navy);
      margin:0;
      line-height:1.1;
      font-weight: 800;
      background: linear-gradient(135deg, var(--brand-navy), var(--brand-mag));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero p{
      color:var(--muted);
      font-size:20px;
      line-height:1.7;
      margin:24px 0;
      font-weight: 400;
    }

    .hero-actions{
      margin-top:40px;
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .hero-actions button{
      padding:18px 36px;
      border-radius:60px;
      font-weight:700;
      cursor:pointer;
      font-size:18px;
      transition:all .3s ease;
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .hero-actions button:hover{
      transform:translateY(-3px);
      box-shadow: var(--shadow-xl);
    }

    .btn-join{
      background:linear-gradient(135deg,var(--brand-mag),var(--brand-navy));
      color:#fff;
      box-shadow: var(--shadow-lg);
    }

    .btn-join:hover{
      transform:scale(1.05) translateY(-3px);
      box-shadow:0 0 30px rgba(10,46,111,.4);
    }

    .btn-secondary {
      background: transparent;
      color: var(--brand-navy);
      border: 2px solid var(--brand-navy);
    }

    .btn-secondary:hover {
      background: var(--brand-navy);
      color: white;
    }

    /* Enhanced hero card */
    .hero-card{
      position:relative;
      border-radius:24px;
      overflow:hidden;
      border:1px solid var(--border);
      box-shadow: var(--shadow-xl);
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(135deg, #f8fafc, #ffffff);
      aspect-ratio: 1.2;
      transform: perspective(1000px) rotateY(-5deg);
      transition: transform 0.3s ease;
      max-width: 400px;
      max-width: fit-content;
      margin: 0 auto;
 
    }

    .hero-card:hover {
      transform: perspective(1000px) rotateY(0deg) scale(1.02);
    }

    .hero-card img{
      width:100%;
      height:100%;
      display:block;
      border-radius: 16px;
      box-shadow: var(--shadow-lg);
    }

    .hero-badge{
      position:absolute;
      bottom:20px;
      right:20px;
      background:rgba(255,255,255,.98);
      padding:12px 18px;
      border-radius:50px;
      border:1px solid var(--border);
      font-size:14px;
      color:var(--brand-navy);
      font-weight:700;
      box-shadow: var(--shadow-md);
      backdrop-filter: blur(10px);
    }

    /* Enhanced sections */
    main{
      display:block;
      position: relative;
    }


    .section-box{
      background:rgba(255,255,255,0.8);
      backdrop-filter: blur(10px);
      border:1px solid var(--border);
      border-radius:20px;
      padding:40px;
      margin:60px auto;
      max-width:1200px;
      box-shadow: var(--shadow-lg);
      opacity:0;
      transform:translateY(30px);
      transition:all .8s ease;
      position: relative;
      overflow: hidden;
    }

    .section-box::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--brand-mag), var(--brand-navy));
      border-radius: 20px 20px 0 0;
    }

    .section-box.visible{
      opacity:1;
      transform:translateY(0);
    }

    .section-box h2{
      margin-top:0;
      color:var(--brand-navy);
      font-size:clamp(28px,3vw,36px);
      font-weight: 800;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .section-box h2::before {
      content: '';
      width: 6px;
      height: 40px;
      background: linear-gradient(180deg, var(--brand-mag), var(--brand-navy));
      border-radius: 3px;
    }

    /* Enhanced ticker */
    .ticker{
      display:flex;
      align-items:center;
      gap:12px;
      background:linear-gradient(90deg,#fff,var(--brand-light-pink));
      border:1px solid #ffd1e4;
      color:#7a133c;
      padding:14px 14px;
      border-radius:16px;
      overflow:hidden;
      min-height:50px;
      box-shadow: var(--shadow-sm);
    }

    .ticker-track{
      display:flex;
      gap:32px;
      white-space:nowrap;
      animation:scrollX 30s linear infinite;
      font-weight: 600;
    }

    .badge{
      font-size:13px;
      padding:8px 12px;
      border-radius:20px;
      display:inline-block;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .b-event{
      background:#ffe4ec;
      border:1px solid #ffb6cf;
      color:#7a133c;
    }

    .b-workshop{
      background:#e0f2fe;
      border:1px solid #93c5fd;
      color:#0c4a6e;
    }

    .b-competition{
      background:#fef9c3;
      border:1px solid #fde68a;
      color:#78350f;
    }

    /* Enhanced filter controls */
    .notice-tools, .tutorial-filters{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin:20px 0;
      align-items: center;
    }

    .notice-tools input, .tutorial-filters input {
      flex: 1;
      min-width: 250px;
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: 12px;
      font-size: 16px;
      background: white;
      box-shadow: var(--shadow-sm);
    }

    .chip, .filter-chip{
      border:1px solid var(--border);
      background:#f8fafc;
      border-radius:25px;
      padding:10px 16px;
      cursor:pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .chip:hover, .filter-chip:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .chip[aria-pressed="true"], .chip.active, .filter-chip.active{
      background:linear-gradient(135deg, var(--brand-mag), var(--brand-navy));
      color: white;
      border-color:var(--brand-mag);
      box-shadow: var(--shadow-md);
    }

    /* Enhanced cards */
    .notice-card, .tutorial-card{
      background:#fff;
      border:1px solid var(--border);
      border-radius:16px;
      padding:20px;
      box-shadow: var(--shadow-md);
      transition:all .3s ease;
      position: relative;
      overflow: hidden;
      max-height: 100%;
    }

    .notice-card::before, .tutorial-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(180deg, var(--brand-mag), var(--brand-navy));
    }

    .notice-card:hover, .tutorial-card:hover{
      transform:translateY(-4px);
      box-shadow: var(--shadow-xl);
      border-color: var(--brand-mag);
    }

    .notice-list{
      display:grid;
      gap:16px;
    }

    .notice-card{
      display:grid;
      grid-template-columns:140px 1fr auto;
      gap:16px;
      align-items:center;
    }

    .notice-card strong{
      display:block;
      margin-bottom:6px;
      font-size: 18px;
      color: var(--brand-navy);
    }

    .notice-card time{
      color:var(--muted);
      font-size:14px;
      font-weight: 500;
    }

    /* Tutorial grid */
    .tutorial-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(380px,1fr));
      gap:24px;
      margin-top:24px;
    }

    .tutorial-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      margin-bottom:16px;
    }

    .tutorial-title{
      font-size:20px;
      font-weight:700;
      color:var(--brand-navy);
      margin:0;
      line-height: 1.3;
    }

    .tutorial-difficulty{
      font-size:12px;
      padding:6px 10px;
      border-radius:16px;
      font-weight:700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .difficulty-beginner{
      background:#dcfce7;
      color:#166534;
      border: 1px solid #bbf7d0;
    }

    .difficulty-intermediate{
      background:#fef3c7;
      color:#92400e;
      border: 1px solid #fde68a;
    }

    .difficulty-advanced{
      background:#fecaca;
      color:#991b1b;
      border: 1px solid #fca5a5;
    }

    .tutorial-category{
      font-size:13px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:1px;
      font-weight: 600;
    }

    .tutorial-desc{
      color:var(--muted);
      font-size:15px;
      margin:12px 0;
      line-height:1.6;
    }

    .tutorial-meta{
      display:flex;
      gap:20px;
      font-size:13px;
      color:var(--muted);
      margin:16px 0;
      font-weight: 500;
    }

    .tutorial-components{
      margin:16px 0;
    }

    .component-list{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:8px;
    }

    .component-tag{
      background:#f1f5f9;
      border:1px solid #cbd5e1;
      padding:4px 10px;
      border-radius:12px;
      font-size:12px;
      color:#475569;
      font-weight: 500;
    }

    .code-preview{
      background:#f8fafc;
      border:1px solid #e2e8f0;
      border-radius:12px;
      padding:16px;
      margin:16px 0;
      font-family:'Fira Code', monospace;
      font-size:13px;
      color:#334155;
      overflow-x:auto;
      white-space:pre-wrap;
      line-height: 1.5;
    }

    .tutorial-actions{
      display:flex;
      gap:10px;
      margin-top:20px;
    }

    .btn-tutorial{
      padding:10px 20px;
      border:1px solid var(--border);
      background:#f8fafc;
      border-radius:12px;
      cursor:pointer;
      font-size:14px;
      font-weight:600;
      transition:.3s ease;
      color: var(--brand-navy);
    }

    .btn-tutorial:hover{
      background:var(--brand-navy);
      color:#fff;
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    /* Stats section */
    .stats-grid{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:20px;
      margin-top:20px;
    }

    .stat-card{
      background:#fff;
      border:1px solid var(--border);
      border-radius:16px;
      padding:32px 24px;
      text-align:center;
      box-shadow: var(--shadow-md);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--brand-mag), var(--brand-navy));
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-xl);
    }

    .stat-num{
      font-size:clamp(32px,5vw,48px);
      font-weight:800;
      color:var(--brand-navy);
      margin-bottom: 8px;
      background: linear-gradient(135deg, var(--brand-navy), var(--brand-mag));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .stat-label{
      font-size:16px;
      color:var(--muted);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Gallery section */
    .gal-rail{
      display:flex;
      gap:16px;
      overflow:hidden;
      border:1px solid var(--border);
      border-radius:16px;
      padding:16px;
      background:#fff;
      box-shadow: var(--shadow-md);
    }

    .card{
      min-width:320px;
      max-width:320px;
      aspect-ratio:4/3;
      border:1px solid var(--border);
      border-radius:16px;
      overflow:hidden;
      position:relative;
      box-shadow: var(--shadow-md);
      transition: all 0.3s ease;
    }

    .card:hover {
      transform: scale(1.02);
      box-shadow: var(--shadow-xl);
    }

    .card img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .card .cap{
      position:absolute;
      left:12px;
      bottom:12px;
      background:rgba(255,255,255,.95);
      backdrop-filter: blur(10px);
      border:1px solid var(--border);
      border-radius:12px;
      padding:8px 12px;
      font-size:14px;
      color:var(--brand-navy);
      font-weight: 600;
      box-shadow: var(--shadow-sm);
    }

    .rail-track{
      display:flex;
      gap:16px;
      animation:rail 45s linear infinite;
    }

    .gal-rail:hover .rail-track{
      animation-play-state:paused;
    }

    /* Enhanced footer */
    footer{
      background:linear-gradient(135deg, #f8fafc, #ffffff);
      padding:40px 24px;
      text-align:center;
      color:var(--muted);
      border-top: 1px solid var(--border);
      margin-top: 60px;
    }

    footer strong {
      color: var(--brand-navy);
      font-size: 18px;
    }

    footer a {
      color: var(--brand-mag);
      text-decoration: none;
      font-weight: 600;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* Enhanced modals */
    .modal{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.6);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:100;
      padding:20px;
      backdrop-filter: blur(4px);
    }

    .modal.open{
      display:flex;
    }

    .modal-card{
      width:min(750px,95vw);
      max-height:90vh;
      background:#fff;
      border:1px solid var(--border);
      border-radius:20px;
      box-shadow: var(--shadow-xl);
      overflow:auto;
      animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .modal-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding:20px 24px;
      border-bottom:1px solid var(--border);
      background: linear-gradient(135deg, #f8fafc, #ffffff);
    }

    .modal-head h3{
      margin:0;
      color:var(--brand-navy);
      font-size:22px;
      font-weight:800;
    }

    .modal-close{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:40px;
      height:40px;
      border-radius:50%;
      border:1px solid var(--border);
      background:#f8fafc;
      cursor:pointer;
      font-size:24px;
      line-height:1;
      transition: all 0.3s ease;
    }

    .modal-close:hover{
      background:#eef2ff;
      border-color: var(--brand-mag);
      color: var(--brand-mag);
      transform: scale(1.05);
    }

    .modal-body{
      padding:24px;
      line-height: 1.6;
    }

    .modal-body label{
      display:block;
      font-size:15px;
      margin:16px 0 8px;
      color:#334155;
      font-weight: 600;
    }

    .modal-body input,.modal-body select,.modal-body textarea{
      width:100%;
      padding:14px 16px;
      border:1px solid var(--border);
      border-radius:12px;
      font-size:16px;
      background:#fff;
      transition: all 0.3s ease;
    }

    .modal-body input:focus,.modal-body select:focus,.modal-body textarea:focus{
      outline: none;
      border-color: var(--brand-mag);
      box-shadow: 0 0 0 3px rgba(255,43,122,0.1);
    }

    .row{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:16px;
    }

    .actions{
      display:flex;
      gap:12px;
      justify-content:flex-end;
      margin-top:24px;
    }

    .btn{
      border:1px solid var(--border);
      background:#f3f4f6;
      border-radius:12px;
      padding:12px 20px;
      cursor:pointer;
      font-weight:600;
      font-size: 15px;
      transition: all 0.3s ease;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn.primary{
      background:linear-gradient(90deg,var(--brand-navy),var(--brand-mag));
      color:#fff;
      border:none;
    }

    .btn.primary:hover {
      box-shadow: var(--shadow-lg);
    }

   
    /* Enhanced responsive design */
    @media (max-width:1024px){
      .hero{
        grid-template-columns:1fr;
        gap:40px;
        padding: 60px 24px;
      }
      
      .hero-card {
        transform: perspective(1000px) rotateY(0deg);
        max-width: 500px;
        margin: 0 auto;
      }

      .stats-grid{
        grid-template-columns:repeat(2,1fr);
      }

      .tutorial-grid{
        grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
      }
    }

    @media (max-width:768px){
      .nav {
        padding: 12px 20px;
      }

      .hero {
        padding: 40px 20px;
        text-align: center;
      }

      .hero h1 {
        font-size: clamp(28px,8vw,48px);
      }

      .hero p {
        font-size: 18px;
      }

      .section-box {
        padding: 24px 20px;
        margin: 40px 16px;
      }

      .notice-card{
        grid-template-columns:1fr;
        text-align: center;
      }

      .row{
        grid-template-columns:1fr;
      }

      .stats-grid{
        grid-template-columns:1fr;
      }

      .tutorial-grid{
        grid-template-columns:1fr;
      }

      .notice-tools, .tutorial-filters {
        flex-direction: column;
        align-items: stretch;
      }

      .notice-tools input, .tutorial-filters input {
        min-width: auto;
      }
    }

    @media (max-width:480px){
      .hero-actions {
        flex-direction: column;
        align-items: center;
      }

      .hero-actions button {
        width: 100%;
        max-width: 280px;
      }

      .modal-card {
        width: 95vw;
        margin: 10px;
      }
    }

    /* Animations */
    @keyframes scrollX{
      from{transform:translateX(0)}
      to{transform:translateX(-50%)}
    }

    @keyframes rail{
      from{transform:translateX(0)}
      to{transform:translateX(-50%)}
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }

    /* Loading states */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .note{
      font-size: 14px;
      padding: 12px 16px;
      border-radius: 12px;
      margin: 16px 0;
      border-left: 4px solid;
    }

    .note.info {
      background: #f0f9ff;
      border-color: #0ea5e9;
      color: #0c4a6e;
    }

    .note.success {
      background: #f0fdf4;
      border-color: #22c55e;
      color: #166534;
    }

    .note.warning {
      background: #fffbeb;
      border-color: #f59e0b;
      color: #92400e;
    }

    .note.error {
      background: #fef2f2;
      border-color: #ef4444;
      color: #991b1b;
    }

    /* Enhanced tutorial modal styles */
    .tutorial-modal .modal-card{
      max-width:1000px;
    }

    .architecture-diagram{
      max-width:100%;
      height:auto;
      border:1px solid var(--border);
      border-radius:12px;
      margin:20px 0;
      box-shadow: var(--shadow-md);
    }

    .code-block{
      background:#1e293b;
      color:#e2e8f0;
      padding:24px;
      border-radius:12px;
      margin:20px 0;
      overflow-x:auto;
      font-family:'Fira Code', monospace;
      font-size:14px;
      line-height:1.6;
      box-shadow: var(--shadow-md);
    }

    .code-block::-webkit-scrollbar {
      height: 8px;
    }

    .code-block::-webkit-scrollbar-track {
      background: #334155;
      border-radius: 4px;
    }

    .code-block::-webkit-scrollbar-thumb {
      background: #64748b;
      border-radius: 4px;
    }

    /* Enhanced button styles */
    .load-more-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin: 24px auto;
      padding: 12px 24px;
      background: linear-gradient(135deg, var(--brand-navy), var(--brand-mag));
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: var(--shadow-md);
    }

    .load-more-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .load-more-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* Progress indicators */
    .progress-bar {
      width: 100%;
      height: 4px;
      background: #e5e7eb;
      border-radius: 2px;
      overflow: hidden;
      margin: 16px 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--brand-mag), var(--brand-navy));
      border-radius: 2px;
      transition: width 0.3s ease;
    }

    /* Enhanced hover effects */
    .interactive-element {
      transition: all 0.3s ease;
    }

    .interactive-element:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    /* Focus styles for accessibility */
    *:focus {
      outline: 2px solid var(--brand-mag);
      outline-offset: 2px;
    }

    button:focus, .btn:focus {
      outline: 2px solid var(--brand-mag);
      outline-offset: 2px;
    }

    /* Print styles */
    @media print {
      .nav, .ticker, .modal, footer {
        display: none;
      }
      
      .section-box {
        break-inside: avoid;
        box-shadow: none;
        border: 1px solid #ccc;
      }
    }
        /* Enhanced gallery cards */
    .card{
      min-width:320px;
      max-width:320px;
      aspect-ratio:4/3;
      border:1px solid var(--border);
      border-radius:16px;
      overflow:hidden;
      position:relative;
      box-shadow: var(--shadow-md);
      transition: all 0.3s ease;
    }

    .card:hover, .gallery-card:hover {
      transform: scale(1.02);
      box-shadow: var(--shadow-xl);
      border-color: var(--brand-mag);
    }

    .gallery-card:focus {
      outline: 2px solid var(--brand-mag);
      outline-offset: 2px;
      transform: scale(1.02);
    }

    .card img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      transition: transform 0.3s ease;
    }

    .gallery-card:hover img {
      transform: scale(1.05);
    }

    .card .cap{
      position:absolute;
      left:12px;
      bottom:12px;
      right:12px;
      background:rgba(255,255,255,.95);
      backdrop-filter: blur(10px);
      border:1px solid var(--border);
      border-radius:12px;
      padding:12px;
      color:var(--brand-navy);
      font-weight: 600;
      box-shadow: var(--shadow-sm);
      transition: all 0.3s ease;
    }

    .gallery-card:hover .cap {
      background: rgba(255,255,255,1);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }
        @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(100%);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
        /* Enhanced ticker */
    .ticker{
      display:flex;
      align-items:center;
      gap:16px;
      background:linear-gradient(90deg,#fff,var(--brand-light-pink));
      border:1px solid #ffd1e4;
      color:#7a133c;
      padding:14px 18px;
      border-radius:16px;
      overflow:hidden;
      min-height:50px;
      box-shadow: var(--shadow-sm);
    }

        .ticker-track{
      display:flex;
      gap:32px;
      white-space:nowrap;
      animation:scrollX 30s linear infinite;
      font-weight: 600;
      flex: 1;
      min-width: 0;
      align-items: center;
    }

    .ticker-track > div {
      white-space: nowrap;
      flex-shrink: 0;
      display: inline-block;
    }

    /* Ensure proper centering when no events */
    .ticker-track[style*="justify-content: center"] {
      animation-duration: 25s;
    }
        @keyframes slideInFromRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOutToRight {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(100%);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }






  </style>
</head>
<body>
  <a href="#main" class="skip-link">Skip to main content</a>

  <nav class="nav" role="navigation" aria-label="Primary navigation" id="mainNav">
    <a href="#home" class="brand">
      <img src="logo.jpeg" alt="Knowledge Garden logo" loading="eager" />
      Knowledge Garden
    </a>
    <div class="nav-toggle" id="navToggle" aria-label="Toggle navigation">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <div class="nav-links" id="navLinks">
      <a href="#home" class="nav-link active">Home</a> 
      <a href="#tutorials" class="nav-link">Tutorials</a>
      <a href="#notifications" class="nav-link">Notifications</a>
      <a href="#gallery" class="nav-link">Gallery</a>
      <a href="#contact" class="nav-link">Contact</a>
    </div>
  </nav>

    <div class="ticker" id="noticeTicker" aria-label="Latest updates">
    <div class="ticker-track" id="tickerTrack" style="justify-content: center; animation-delay: -12.5s;">
      <div>Welcome to Knowledge Garden • Empower • Innovate • Collaborate</div>
      <div>Welcome to Knowledge Garden • Empower • Innovate • Collaborate</div>
    </div>
  </div>

  <main id="main">
    <header class="hero" id="home">
      <div>
        <h1>The Future of IoT Learning</h1>
        <p>
          <strong>Cultivate Innovation</strong> – Providing students with hands-on exposure, cutting-edge tools, and expert mentorship to experiment, build, and innovate in the Internet of Things ecosystem.
        </p>
        <p>
          <strong>Connect Knowledge with Practice</strong> – Bridging theoretical classroom learning with real-world applications through industry-relevant projects, collaborative research, and meaningful partnerships.
        </p>
        <p>
          <strong>Empower the Next Generation</strong> – Fostering teamwork, curiosity, and systematic problem-solving, transforming every learner from a student of engineering into a creator of solutions for tomorrow's challenges.
        </p>
        <div class="hero-actions">
          <button class="btn-join" id="openJoin">
            Join Our Community
          </button>
          <button class="btn-secondary" onclick="document.getElementById('tutorials').scrollIntoView({behavior:'smooth'})">
            Explore Tutorials
          </button>
        </div>
      </div>
      <div class="hero-card" aria-hidden="true">
        <img src="logo.jpeg" alt="Knowledge Garden Innovation" loading="lazy"/>
        
            
        <span class="hero-badge">Tech Society • Since 2025</span>
      </div>

      <!-- Enhanced Join Modal -->
      <div class="modal" id="joinModal" aria-modal="true" role="dialog" aria-labelledby="joinModalTitle">
        <div class="modal-card">
          <div class="modal-head">
            <h3 id="joinModalTitle">Join Knowledge Garden Community</h3>
            <button class="modal-close" id="closeJoin" aria-label="Close join form">&times;</button>
          </div>
          <div class="modal-body">
            <div class="note info">
              <strong>Welcome!</strong> Join our vibrant community of learners, mentors, and innovators shaping the future of IoT technology.
            </div>
            
            <label for="role">I am a</label>
            <select id="role" required>
              <option value="">Select your role</option>
              <option value="learner">Learner - Ready to explore IoT</option>
              <option value="mentor">Mentor - Share your expertise</option>
              <option value="partner">Industry Partner - Collaborate with us</option>
            </select>

            <label for="fullName">Full Name *</label>
            <input id="fullName" type="text" placeholder="Enter your full name" required />

            <div class="row">
              <div>
                <label for="email">Email Address *</label>
                <input id="email" type="email" placeholder="your.email@example.com" required />
              </div>
              <div>
                <label for="phone">Phone Number</label>
                <input id="phone" type="tel" placeholder="+91 98765 43210" />
              </div>
            </div>
            
            <label for="extra">Department / Expertise / Organization</label>
            <input id="extra" type="text" placeholder="e.g., Computer Science / IoT Development / Acme Technologies" />
            
            <label for="message">Tell us about your interest</label>
            <textarea id="message" rows="4" placeholder="Share your goals, interests, or how you'd like to contribute to our community..."></textarea>
            
            <div class="actions">
              <button class="btn" id="cancelJoin">Cancel</button>
              <button class="btn primary" id="submitJoin">
                <span id="joinBtnText">Submit Application</span>
                <span id="joinBtnLoader" class="loading" style="display:none;"></span>
              </button>
            </div>
            <div id="joinMsg" class="note" role="status" aria-live="polite" style="display:none;"></div>
          </div>
        </div>
      </div>
    </header>
    
    
    <!-- Enhanced Community Stats Section -->
    <section id="stats" class="section-box" aria-labelledby="stats-title">
      <h2 id="stats-title"> Our Growing Community</h2>
      <p style="color:var(--muted);font-size:18px;margin-bottom:32px;text-align:center;">
        Join thousands of passionate learners, experienced mentors, and industry partners building the future of IoT together.
      </p>
      <div class="stats-grid" role="group" aria-label="Community statistics">
        <div class="stat-card interactive-element" aria-live="polite">
          <div class="stat-num" id="countLearners">0</div>
          <div class="stat-label">Active Learners</div>
        </div>
        <div class="stat-card interactive-element" aria-live="polite">
          <div class="stat-num" id="countMentors">0</div>
          <div class="stat-label">Expert Mentors</div>
        </div>
        <div class="stat-card interactive-element" aria-live="polite">
          <div class="stat-num" id="countPartners">0</div>
          <div class="stat-label">Industry Partners</div>
        </div>
      </div>
      <div id="statsMsg" class="note" role="status" aria-live="polite" style="display:none;"></div>
    </section>
    
    <!-- Enhanced Tutorials Section -->
    <section id="tutorials" class="section-box" aria-labelledby="tutorials-title">
      <h2 id="tutorials-title">Tutorials</h2>
      
      <!-- Enhanced Tutorial Notifications -->
      <div class="ticker" style="margin-bottom: 24px;" aria-label="Tutorial updates">
        <div style="display: flex; align-items: center; gap: 16px; min-width: auto;">
          <span style="font-weight: 700; color: var(--brand-navy); white-space: nowrap; flex-shrink: 0;"></span>
          <div class="ticker-track" id="tutorialTicker" style="overflow: hidden;">
            <div>New Arduino ESP32 tutorials • Advanced sensor integration • Machine Learning on Edge • Solar IoT projects • Smart home automation • Robotics fundamentals</div>
            <div>New Arduino ESP32 tutorials • Advanced sensor integration • Machine Learning on Edge • Solar IoT projects • Smart home automation • Robotics fundamentals</div>
          </div>
        </div>
      </div>
      <div class="tutorial-filters" role="toolbar" aria-label="Tutorial filters">
        <input id="tutorialSearch" type="search" placeholder=" Search tutorials, components, or topics..." aria-label="Search tutorials" />
        <button class="filter-chip active" data-category="all" aria-pressed="true">All Tutorials</button>
        <button class="filter-chip" data-category="sensor" aria-pressed="false">Sensors</button>
        
        <button class="filter-chip" data-category="automation" aria-pressed="false">Automation</button>
        <button class="filter-chip" data-category="ai-ml" aria-pressed="false">AI/ML</button>
        <button class="filter-chip" data-category="robotics" aria-pressed="false"> Robotics</button>

      </div>

      <div class="tutorial-grid" id="tutorialGrid" aria-live="polite">
        <div class="note info">Loading innovative tutorials...</div>
      </div>
      <div id="tutorialError" class="note error" role="alert" style="display:none;"></div>
      <div id="tutorialHint" class="note info"> <strong>Pro Tip:</strong> Click on any tutorial to access complete source code, wiring diagrams, and step-by-step implementation guides!</div>
    </section>

    <!-- Enhanced Tutorial Details Modal -->
    <div class="modal tutorial-modal" id="tutorialModal" aria-modal="true" role="dialog" aria-labelledby="tutorialModalTitle">
      <div class="modal-card">
        <div class="modal-head">
          <h3 id="tutorialModalTitle">Tutorial Deep Dive</h3>
          <button class="modal-close" id="closeTutorial" aria-label="Close tutorial">&times;</button>
        </div>
        <div class="modal-body" id="tutorialModalBody">
          <div class="note info">Loading comprehensive tutorial content...</div>
        </div>
      </div>
    </div>

    

    <!-- Enhanced Notification Details Modal -->
    <div class="modal" id="notifModal" aria-modal="true" role="dialog" aria-labelledby="notifModalTitle">
      <div class="modal-card">
        <div class="modal-head">
          <h3 id="notifTitle">Event Details</h3>
          <button class="modal-close" id="closeNotif" aria-label="Close details">&times;</button>
        </div>
        <div class="modal-body" id="notifBody">
          <div class="note info">Loading event information...</div>
        </div>
      </div>
    </div>

    <!-- Enhanced Gallery Section -->
    <section id="gallery" class="section-box" aria-labelledby="gallery-title">
      <h2 id="gallery-title"> Innovation Showcase</h2>
      <p style="color:var(--muted);font-size:18px;margin-bottom:24px;text-align:center;">
        Discover amazing IoT projects created by our community members. Get inspired and contribute your own innovations!
      </p>
      <div class="gal-wrap">
        <div class="gal-rail">
          <div class="rail-track" id="galTrack">
            <div class="note info" style="display:flex;align-items:center;justify-content:center;min-width:320px;">
              Loading project showcase...
            </div>
          </div>
        </div>
        <div id="galError" class="note error" role="alert" style="display:none;"></div>
      </div>
    </section>
    <!-- Enhanced Notifications Section -->
    <section id="notifications" class="section-box" aria-labelledby="notif-title">
      <h2 id="notif-title"> Community Updates</h2>
      <p style="color:var(--muted);font-size:18px;margin-bottom:24px;">
        Stay connected with the latest events, workshops, competitions, and opportunities in our IoT community.
      </p>

      <div class="notice-tools" role="toolbar" aria-label="Notice filters">
        <input id="noticeSearch" type="search" placeholder=" Search events, workshops, competitions..." aria-label="Search notices" />
        <button class="chip active" data-cat="all" aria-pressed="true">All Updates</button>
        <button class="chip" data-cat="event" aria-pressed="false"> Events</button>
        <button class="chip" data-cat="workshop" aria-pressed="false"> Workshops</button>
        <button class="chip" data-cat="competition" aria-pressed="false"> Competitions</button>
        <button class="chip" data-today="true" aria-pressed="false"> Today</button>
      </div>

      <div class="notice-list" id="noticeList" aria-live="polite">
        <div class="note info">Loading community updates...</div>
      </div>
      <div id="noticeError" class="note error" role="alert" style="display:none;"></div>
      <div id="noticeHint" class="note info"><strong>Tip:</strong> Use the search and filters above to find specific events or topics that interest you.</div>
    </section>
    
  </main>

  <!-- Enhanced Footer -->
  <footer id="contact">
    <div style="max-width:800px;margin:0 auto;">
      <strong style="font-size:24px;color:var(--brand-navy);"> Knowledge Garden</strong>
      <p style="margin:16px 0;font-size:18px;">EGS Pillay Engineering College</p>
      <p style="margin:16px 0;">
        <a href="mailto:knowledgegarden@egspec.org" style="font-size:18px;">knowledgegarden@egspec.org</a>
      </p>
      
      <div style="margin:24px 0;padding:20px;background:rgba(10,46,111,0.05);border-radius:16px;border:1px solid var(--border);">
        <p style="margin:0;font-style:italic;color:var(--brand-navy);">
          "Empowering the next generation of IoT innovators through hands-on learning, collaborative projects, and real-world applications."
        </p>
      </div>
      
      <div style="margin-top:20px;display:flex;justify-content:center;gap:16px;flex-wrap:wrap;" aria-label="Quick links">
        <a href="#tutorials" style="color:var(--brand-mag);text-decoration:none;font-weight:600;"> Tutorials</a>
        <a href="#notifications" style="color:var(--brand-mag);text-decoration:none;font-weight:600;"> Events</a>
        <a href="#gallery" style="color:var(--brand-mag);text-decoration:none;font-weight:600;"> Gallery</a>
        <!-- <a href="admin.html" style="color:var(--brand-mag);text-decoration:none;font-weight:600;"> Admin</a> -->
      </div>
    </div>
    <small style="opacity:.75;margin-top:20px;display:block;">
      <span id="year"></span> Knowledge Garden • Built with for IoT Education
    </small>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const API_BASE = window.API_BASE || '';

      // Enhanced navigation scroll effect
      const nav = document.getElementById('mainNav');
      const navLinks = document.querySelectorAll('.nav-link');
      
      window.addEventListener('scroll', () => {
        if (window.scrollY > 100) {
          nav.classList.add('scrolled');
        } else {
          nav.classList.remove('scrolled');
        }

        // Update active navigation link
        const sections = document.querySelectorAll('section[id], header[id]');
        let current = '';
        
        sections.forEach(section => {
          const sectionTop = section.offsetTop;
          const sectionHeight = section.clientHeight;
          if (window.scrollY >= (sectionTop - 200)) {
            current = section.getAttribute('id');
          }
        });

        navLinks.forEach(link => {
          link.classList.remove('active');
          if (link.getAttribute('href') === `#${current}`) {
            link.classList.add('active');
          }
        });
      });

      // Mobile navigation toggle
      const navToggle = document.getElementById('navToggle');
      const navLinksContainer = document.getElementById('navLinks');
      
      navToggle?.addEventListener('click', () => {
        navLinksContainer.classList.toggle('active');
      });

      // Close mobile nav when clicking links
      navLinks.forEach(link => {
        link.addEventListener('click', () => {
          navLinksContainer.classList.remove('active');
        });
      });

      // Enhanced section reveal animation
      const revealSection = (entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            observer.unobserve(entry.target);
          }
        });
      };

      if ('IntersectionObserver' in window) {
        const sectionObserver = new IntersectionObserver(revealSection, {
          threshold: 0.15,
          rootMargin: '0px 0px -50px 0px'
        });
        
        document.querySelectorAll('.section-box').forEach(section => {
          sectionObserver.observe(section);
        });
      } else {
        document.querySelectorAll('.section-box').forEach(section => {
          section.classList.add('visible');
        });
      }

      // Set current year
      const yearEl = document.getElementById('year');
      if (yearEl) yearEl.textContent = new Date().getFullYear();

      // Enhanced utility functions
      const toQS = obj => Object.entries(obj)
        .filter(([,v]) => v !== undefined && v !== '' && v !== 'all')
        .map(([k,v]) => `${encodeURIComponent(k)}=${encodeURIComponent(v)}`)
        .join('&');

      const showLoading = (element, message = 'Loading...') => {
        if (element) {
          element.innerHTML = `<div class="note info">${message}</div>`;
        }
      };

      const showError = (element, message) => {
        if (element) {
          element.innerHTML = `<div class="note error">${message}</div>`;
        }
      };

      const showSuccess = (element, message) => {
        if (element) {
          element.innerHTML = `<div class="note success">${message}</div>`;
        }
      };

      // Enhanced API functions with better error handling
      async function apiRequest(path, options = {}) {
        try {
          const url = `${API_BASE}${path}`;
          const response = await fetch(url, {
            headers: {
              'Content-Type': 'application/json',
              ...options.headers
            },
            ...options
          });

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          return await response.json();
        } catch (error) {
          console.error('API Request failed:', error);
          throw error;
        }
      }

      async function getJSON(path, params = {}) {
        const queryString = Object.keys(params).length ? `?${toQS(params)}` : '';
        return apiRequest(`${path}${queryString}`);
      }

      async function postJSON(path, body = {}) {
        return apiRequest(path, {
          method: 'POST',
          body: JSON.stringify(body)
        });
      }

      // Enhanced helper functions
      const catBadge = c => ({
        event: 'b-event',
        workshop: 'b-workshop', 
        competition: 'b-competition'
      })[c] || 'b-event';

      const isTodayIST = (iso) => {
        if (!iso) return false;
        const d = new Date(iso);
        const now = new Date();
        return d.getFullYear() === now.getFullYear() && 
               d.getMonth() === now.getMonth() && 
               d.getDate() === now.getDate();
      };

      const fmtDate = (s) => {
        if (!s) return '-';
        const d = new Date(s);
        if (isNaN(d)) return '-';
        const options = {
          weekday: 'short',
          day: '2-digit', 
          month: 'short',
          hour: '2-digit',
          minute: '2-digit'
        };
        return d.toLocaleString(undefined, options);
      };

      // ===== ENHANCED NOTIFICATIONS SYSTEM =====
      const noticeList = document.getElementById('noticeList');
      const noticeSearch = document.getElementById('noticeSearch');
      const tickerTrack = document.getElementById('tickerTrack');
      const noticeError = document.getElementById('noticeError');
      let nFilters = { search: '', cat: 'all', today: false, page: 1, limit: 10 };
      let noticesLoading = false;

      const defaultGreeting = 'Welcome to Knowledge Garden • Empower • Innovate • Collaborate';

      function renderEmptyNotices() {
        if (noticeList) {
          noticeList.innerHTML = `<div class="note info"> No notifications match your current filters. Try adjusting your search or filter criteria.</div>`;
        }
      }

             function updateTicker(items = []) {
        if (!tickerTrack) return;
        
        const defaultGreeting = 'Welcome to Knowledge Garden • Empower • Innovate • Collaborate';
        
        if (!items.length) {
          // Show only default greeting when no events
          tickerTrack.innerHTML = `<div>${defaultGreeting}</div><div>${defaultGreeting}</div>`;
          tickerTrack.style.justifyContent = 'center';
          tickerTrack.style.animationDelay = '-12.5s';
          return;
        }

        // Combine default greeting with event information
        const eventInfo = items.slice(0, 6).map(n => 
          `<span class="badge ${catBadge(n.cat)}">${(n.cat || 'event').toUpperCase()}</span> ${n.title} • ${fmtDate(n.when)}`
        ).join(' • ');
        
        const combinedContent = `${defaultGreeting} • ${eventInfo}`;
        
        tickerTrack.innerHTML = `<div>${combinedContent}</div><div>${combinedContent}</div>`;
        tickerTrack.style.justifyContent = 'flex-start';
        tickerTrack.style.animationDelay = '-12.5s';
      }

      async function loadNotices({ append = false } = {}) {
        if (noticesLoading) return;
        noticesLoading = true;
        
        if (noticeError) noticeError.style.display = 'none';
        
        if (!append) {
          showLoading(noticeList, '📡 Loading community updates...');
        }

        try {
          const params = {
            search: nFilters.search,
            cat: nFilters.cat,
            today: nFilters.today ? 'true' : undefined,
            page: nFilters.page,
            limit: nFilters.limit
          };

          const data = await getJSON('/api/notifications', params);
          
          if (!Array.isArray(data)) {
            throw new Error('Invalid response format received from server');
          }

          const items = nFilters.today ? data.filter(n => isTodayIST(n.when)) : data;

          if (!append && noticeList) {
            noticeList.innerHTML = '';
          }

          if (!items.length) {
            renderEmptyNotices();
            updateTicker();
            return;
          }

                    // Update ticker on first page load
          if (nFilters.page === 1) {
            updateTicker(items);
          }

          // Render notice cards
          const noticeCards = items.map(n => `
            <article class="notice-card interactive-element">
              <div>
                <div class="badge ${catBadge(n.cat)}">${(n.cat || 'event').toUpperCase()}</div>
              </div>
              <div>
                <strong>${n.title}</strong>
                <time datetime="${n.when}">${fmtDate(n.when)} ${n.venue ? `📍 ${n.venue}` : ''}</time>
              </div>
              <button class="chip details-btn"
                data-id="${n.id || n._id}"
                data-title="${(n.title || '').replace(/"/g, '&quot;')}"
                data-when="${n.when || ''}"
                data-venue="${(n.venue || '').replace(/"/g, '&quot;')}"
                data-cat="${n.cat || 'event'}"
                aria-label="View details for ${n.title}">
                View Details
              </button>
            </article>
          `).join('');

          if (noticeList) {
            noticeList.insertAdjacentHTML('beforeend', noticeCards);
          }

          // Show/hide load more button
          if (loadMoreBtn) {
            loadMoreBtn.style.display = items.length < nFilters.limit ? 'none' : 'inline-flex';
          }

        } catch (error) {
          console.error('Failed to load notices:', error);
          if (noticeList && !append) {
            noticeList.innerHTML = '';
          }
          if (noticeError) {
            noticeError.textContent = `Failed to load notifications: ${error.message}`;
            noticeError.style.display = 'block';
          }
          // Ensure ticker shows default greeting on error
          updateTicker();
        } finally {
          noticesLoading = false;
        }
      }

      // Create enhanced load more button
      const loadMoreBtn = document.createElement('button');
      loadMoreBtn.className = 'load-more-btn';
      loadMoreBtn.innerHTML = '<span>Load More Updates</span>';
      loadMoreBtn.style.display = 'none';
      
      loadMoreBtn.addEventListener('click', () => {
        nFilters.page++;
        loadNotices({ append: true });
      });

      const noticesSection = document.getElementById('notifications');
      if (noticesSection) {
        const btnContainer = document.createElement('div');
        btnContainer.style.textAlign = 'center';
        btnContainer.style.marginTop = '24px';
        btnContainer.appendChild(loadMoreBtn);
        noticesSection.appendChild(btnContainer);
      }

      // Enhanced search and filter handlers
      let searchTimeout;
      if (noticeSearch) {
        noticeSearch.addEventListener('input', (e) => {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => {
            nFilters.search = e.target.value.trim();
            nFilters.page = 1;
            loadNotices();
          }, 500);
        });
      }

      document.querySelectorAll('.notice-tools .chip').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.notice-tools .chip').forEach(b => {
            b.classList.remove('active');
            b.setAttribute('aria-pressed', 'false');
          });
          
          btn.classList.add('active');
          btn.setAttribute('aria-pressed', 'true');
          
          nFilters.cat = btn.dataset.cat || 'all';
          nFilters.today = btn.dataset.today === 'true';
          nFilters.page = 1;
          loadNotices();
        });
      });
            // ===== ENHANCED TUTORIALS SYSTEM =====
      const tutorialGrid = document.getElementById('tutorialGrid');
      const tutorialSearch = document.getElementById('tutorialSearch');
      const tutorialError = document.getElementById('tutorialError');
      const tutorialModal = document.getElementById('tutorialModal');
      const tutorialModalTitle = document.getElementById('tutorialModalTitle');
      const tutorialModalBody = document.getElementById('tutorialModalBody');
      const closeTutorial = document.getElementById('closeTutorial');
      let tFilters = { search: '', category: 'all', page: 1, limit: 20 };
      let tutorialsLoading = false;

      const difficultyClass = d => ({
        beginner: 'difficulty-beginner',
        intermediate: 'difficulty-intermediate', 
        advanced: 'difficulty-advanced'
      })[d] || 'difficulty-beginner';

      // const categoryEmoji = c => ({
      //   sensor: '📊',
      //   communication: '📡',
      //   automation: '🏠',
      //   'ai-ml': '🤖',
      //   robotics: '🦾',
      //   energy: '⚡'
      // })[c] || '🔧';

      function renderEmptyTutorials() {
        if (tutorialGrid) {
          tutorialGrid.innerHTML = `
            <div class="note info" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
              <h3 style="margin-bottom: 16px;"> No tutorials found</h3>
              <p>Try adjusting your search terms or explore different categories to discover amazing IoT projects!</p>
            </div>
          `;
        }
      }

            async function loadTutorials({ append = false } = {}) {
        if (tutorialsLoading) return;
        tutorialsLoading = true;

        if (tutorialError) tutorialError.style.display = 'none';
        
        if (!append) {
          showLoading(tutorialGrid, ' Loading cutting-edge tutorials...');
        }

        try {
          const params = {
            search: tFilters.search,
            category: tFilters.category,
            page: tFilters.page,
            limit: 2 // Show only 2 tutorials on home page
          };

          const data = await getJSON('/api/tutorials', params);
          
          if (!Array.isArray(data)) {
            throw new Error('Invalid response format received from server');
          }

          if (!append && tutorialGrid) {
            tutorialGrid.innerHTML = '';
          }

          if (!data.length) {
            renderEmptyTutorials();
            return;
          }

          const tutorialCards = data.map(t => `
            <article class="tutorial-card interactive-element">
              <div class="tutorial-header">
                <h3 class="tutorial-title">${t.title}</h3>
                <span class="tutorial-difficulty ${difficultyClass(t.difficulty)}">
                  ${(t.difficulty || 'beginner').toUpperCase()}
                </span>
              </div>
              
              <div class="tutorial-category">
                ${categoryEmoji(t.category)} ${(t.category || 'sensor').replace('-', ' ').toUpperCase()}
              </div>
              
              <p class="tutorial-desc">${(t.description || '').substring(0, 140)}${t.description?.length > 140 ? '...' : ''}</p>
              
              <div class="tutorial-meta">
                <span title="Estimated completion time"> ${t.estimatedTime || '30 minutes'}</span>
                <span title="Tutorial author"> ${t.author || 'Knowledge Garden Team'}</span>
                ${t.location ? `<span title="Tutorial location"> ${t.location}</span>` : ''}
              </div>
              
              ${t.components?.length ? `
                <div class="tutorial-components">
                  <strong style="font-size:13px;color:var(--muted);display:block;margin-bottom:8px;">
                    🔧 Required Components:
                  </strong>
                  <div class="component-list">
                    ${t.components.slice(0,4).map(c => `<span class="component-tag">${c}</span>`).join('')}
                    ${t.components.length > 4 ? `<span class="component-tag">+${t.components.length-4} more</span>` : ''}
                  </div>
                </div>
              ` : ''}
              
              <div class="code-preview">${(t.codeSnippet || 'No code preview available').substring(0, 180)}${t.codeSnippet?.length > 180 ? '...' : ''}</div>
              
              <div class="tutorial-actions">
                <button class="btn-tutorial view-tutorial-btn" 
                  data-id="${t._id}" 
                  data-title="${(t.title || '').replace(/"/g, '&quot;')}"
                  aria-label="View complete tutorial for ${t.title}">
                  <span></span> View Complete Tutorial
                </button>
              </div>
            </article>
          `).join('');

          if (tutorialGrid) {
            tutorialGrid.insertAdjacentHTML('beforeend', tutorialCards);
          }

          // Add "View More" button after tutorials
          addViewMoreButton();

        } catch (error) {
          console.error('Failed to load tutorials:', error);
          if (tutorialGrid && !append) {
            tutorialGrid.innerHTML = '';
          }
          if (tutorialError) {
            tutorialError.textContent = `Failed to load tutorials: ${error.message}`;
            tutorialError.style.display = 'block';
          }
        } finally {
          tutorialsLoading = false;
        }
      }

      // Add function to create "View More" button
      function addViewMoreButton() {
        // Remove existing view more button if present
        const existingButton = document.getElementById('viewMoreTutorials');
        if (existingButton) {
          existingButton.remove();
        }

        // Create new "View More" button
        const viewMoreButton = document.createElement('div');
        viewMoreButton.id = 'viewMoreTutorials';
        viewMoreButton.style.cssText = `
          display: flex;
          justify-content: center;
          margin-top: 32px;
          padding-top: 24px;
          border-top: 1px solid var(--border);
        `;
        
        viewMoreButton.innerHTML = `
          <button class="btn-tutorial" style="
            background: linear-gradient(135deg, var(--brand-navy), var(--brand-mag));
            color: white;
            border: none;
            padding: 16px 32px;
            font-size: 16px;
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
          " onclick="openIoTTutorialsPage()" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='var(--shadow-lg)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow-md)'">
            <span></span> View All IoT Tutorials
          </button>
        `;

        // Insert after tutorial grid
        const tutorialsSection = document.getElementById('tutorials');
        if (tutorialsSection && tutorialGrid) {
          tutorialGrid.parentNode.insertBefore(viewMoreButton, tutorialGrid.nextSibling);
        }
      }

      // Function to open IoT Tutorials page
      window.openIoTTutorialsPage = function() {
        // Create the IoT tutorials page content
        const iotTutorialsPage = document.createElement('div');
        iotTutorialsPage.id = 'iotTutorialsPage';
        iotTutorialsPage.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: var(--bg);
          z-index: 200;
          overflow-y: auto;
          animation: slideInFromRight 0.3s ease;
        `;

        iotTutorialsPage.innerHTML = `
          <div style="min-height: 100vh;">
            <!-- Header -->
            <div style="background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border); padding: 16px 24px; position: sticky; top: 0; z-index: 50; box-shadow: var(--shadow-sm);">
              <div style="max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between;">
                <div style="display: flex; align-items: center; gap: 16px;">
                  <button onclick="closeIoTTutorialsPage()" style="
                    display: flex; align-items: center; gap: 8px; background: none; border: 1px solid var(--border); 
                    border-radius: 12px; padding: 10px 16px; cursor: pointer; color: var(--brand-navy); font-weight: 600;
                    transition: all 0.3s ease;
                  " onmouseover="this.style.background='#f1f5f9'" onmouseout="this.style.background='none'">
                    <span>←</span> Back to Home
                  </button>
                  <h1 style="margin: 0; color: var(--brand-navy); font-size: 28px; font-weight: 800; display: flex; align-items: center; gap: 12px;">
                    <span></span> IoT Learning Hub
                  </h1>
                </div>
                <div style="color: var(--muted); font-size: 14px; font-weight: 600;">
                  Knowledge Garden • Comprehensive IoT Tutorials
                </div>
              </div>
            </div>

            <!-- Content -->
            <div style="max-width: 1200px; margin: 0 auto; padding: 32px 24px;">
              <!-- Enhanced Tutorial Notifications -->
              <div class="ticker" style="margin-bottom: 32px;" aria-label="Tutorial updates">
                <div style="display: flex; align-items: center; gap: 16px; min-width: 120px;">
                  <span style="font-weight: 700; color: var(--brand-navy); white-space: nowrap; flex-shrink: 0;">Latest:</span>
                  <div class="ticker-track" style="overflow: hidden;">
                    <div>New Arduino ESP32 tutorials • Advanced sensor integration • Machine Learning on Edge • Solar IoT projects • Smart home automation • Robotics fundamentals</div>
                    <div>New Arduino ESP32 tutorials • Advanced sensor integration • Machine Learning on Edge • Solar IoT projects • Smart home automation • Robotics fundamentals</div>
                  </div>
                </div>
              </div>

              <!-- Filters -->
              <div class="tutorial-filters" role="toolbar" aria-label="Tutorial filters" style="margin-bottom: 32px;">
                <input id="allTutorialSearch" type="search" placeholder=" Search all tutorials, components, or topics..." aria-label="Search tutorials" />
                <button class="filter-chip active" data-category="all" aria-pressed="true">All Tutorials</button>
                <button class="filter-chip" data-category="sensor" aria-pressed="false"> Sensors</button>
                <button class="filter-chip" data-category="automation" aria-pressed="false"> Automation</button>
                <button class="filter-chip" data-category="ai-ml" aria-pressed="false"> AI/ML</button>
                <button class="filter-chip" data-category="robotics" aria-pressed="false"> Robotics</button>
              </div>

              <!-- Tutorials Grid -->
              <div class="tutorial-grid" id="allTutorialGrid" aria-live="polite">
                <div class="note info"> Loading all IoT tutorials...</div>
              </div>
              
              <!-- Load More Button -->
              <div id="loadMoreContainer" style="text-align: center; margin-top: 32px; display: none;">
                <button id="loadMoreAllTutorials" class="btn-tutorial" style="
                  background: linear-gradient(135deg, var(--brand-navy), var(--brand-mag));
                  color: white; border: none; padding: 12px 24px; border-radius: 12px;
                  font-weight: 600; cursor: pointer; transition: all 0.3s ease;
                ">
                  <span></span> Load More Tutorials
                </button>
              </div>

              <div id="allTutorialError" class="note error" role="alert" style="display:none; margin-top: 16px;"></div>
            </div>
          </div>
        `;

        // Add the page to document
        document.body.appendChild(iotTutorialsPage);
        document.body.style.overflow = 'hidden'; // Prevent background scrolling

        // Initialize the all tutorials page
        initializeAllTutorialsPage();
      };

      // Function to close IoT Tutorials page
      window.closeIoTTutorialsPage = function() {
        const iotPage = document.getElementById('iotTutorialsPage');
        if (iotPage) {
          iotPage.style.animation = 'slideOutToRight 0.3s ease';
          setTimeout(() => {
            iotPage.remove();
            document.body.style.overflow = 'auto'; // Restore scrolling
          }, 300);
        }
      };

      // Initialize all tutorials page functionality
      function initializeAllTutorialsPage() {
        let allTutorialsFilters = { search: '', category: 'all', page: 1, limit: 12 };
        let allTutorialsLoading = false;

        const allTutorialGrid = document.getElementById('allTutorialGrid');
        const allTutorialSearch = document.getElementById('allTutorialSearch');
        const allTutorialError = document.getElementById('allTutorialError');
        const loadMoreContainer = document.getElementById('loadMoreContainer');
        const loadMoreBtn = document.getElementById('loadMoreAllTutorials');

        // Load all tutorials function
        async function loadAllTutorials({ append = false } = {}) {
          if (allTutorialsLoading) return;
          allTutorialsLoading = true;

          if (allTutorialError) allTutorialError.style.display = 'none';
          
          if (!append) {
            showLoading(allTutorialGrid, ' Loading comprehensive IoT tutorials...');
          }

          try {
            const params = {
              search: allTutorialsFilters.search,
              category: allTutorialsFilters.category,
              page: allTutorialsFilters.page,
              limit: allTutorialsFilters.limit
            };

            const data = await getJSON('/api/tutorials', params);
            
            if (!Array.isArray(data)) {
              throw new Error('Invalid response format received from server');
            }

            if (!append && allTutorialGrid) {
              allTutorialGrid.innerHTML = '';
            }

            if (!data.length) {
              if (allTutorialGrid) {
                allTutorialGrid.innerHTML = `
                  <div class="note info" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                    <h3 style="margin-bottom: 16px;"> No tutorials found</h3>
                    <p>Try adjusting your search terms or explore different categories to discover amazing IoT projects!</p>
                  </div>
                `;
              }
              loadMoreContainer.style.display = 'none';
              return;
            }

            const tutorialCards = data.map(t => `
              <article class="tutorial-card interactive-element">
                <div class="tutorial-header">
                  <h3 class="tutorial-title">${t.title}</h3>
                  <span class="tutorial-difficulty ${difficultyClass(t.difficulty)}">
                    ${(t.difficulty || 'beginner').toUpperCase()}
                  </span>
                </div>
                
                <div class="tutorial-category">
                  ${categoryEmoji(t.category)} ${(t.category || 'sensor').replace('-', ' ').toUpperCase()}
                </div>
                
                <p class="tutorial-desc">${(t.description || '').substring(0, 140)}${t.description?.length > 140 ? '...' : ''}</p>
                
                <div class="tutorial-meta">
                  <span title="Estimated completion time"> ${t.estimatedTime || '30 minutes'}</span>
                  <span title="Tutorial author"> ${t.author || 'Knowledge Garden Team'}</span>
                  ${t.location ? `<span title="Tutorial location">${t.location}</span>` : ''}
                </div>
                
                ${t.components?.length ? `
                  <div class="tutorial-components">
                    <strong style="font-size:13px;color:var(--muted);display:block;margin-bottom:8px;">
                      🔧 Required Components:
                    </strong>
                    <div class="component-list">
                      ${t.components.slice(0,4).map(c => `<span class="component-tag">${c}</span>`).join('')}
                      ${t.components.length > 4 ? `<span class="component-tag">+${t.components.length-4} more</span>` : ''}
                    </div>
                  </div>
                ` : ''}
                
                <div class="code-preview">${(t.codeSnippet || 'No code preview available').substring(0, 180)}${t.codeSnippet?.length > 180 ? '...' : ''}</div>
                
                <div class="tutorial-actions">
                  <button class="btn-tutorial view-tutorial-btn" 
                    data-id="${t._id}" 
                    data-title="${(t.title || '').replace(/"/g, '&quot;')}"
                    aria-label="View complete tutorial for ${t.title}">
                    <span></span> View Complete Tutorial
                  </button>
                </div>
              </article>
            `).join('');

            if (allTutorialGrid) {
              allTutorialGrid.insertAdjacentHTML('beforeend', tutorialCards);
            }

            // Show/hide load more button
            if (loadMoreContainer) {
              loadMoreContainer.style.display = data.length < allTutorialsFilters.limit ? 'none' : 'block';
            }

          } catch (error) {
            console.error('Failed to load all tutorials:', error);
            if (allTutorialGrid && !append) {
              allTutorialGrid.innerHTML = '';
            }
            if (allTutorialError) {
              allTutorialError.textContent = `Failed to load tutorials: ${error.message}`;
              allTutorialError.style.display = 'block';
            }
          } finally {
            allTutorialsLoading = false;
          }
        }

        // Search functionality
        let allTutorialSearchTimeout;
        if (allTutorialSearch) {
          allTutorialSearch.addEventListener('input', (e) => {
            clearTimeout(allTutorialSearchTimeout);
            allTutorialSearchTimeout = setTimeout(() => {
              allTutorialsFilters.search = e.target.value.trim();
              allTutorialsFilters.page = 1;
              loadAllTutorials();
            }, 500);
          });
        }

        // Filter functionality
        const iotPage = document.getElementById('iotTutorialsPage');
        if (iotPage) {
          iotPage.querySelectorAll('.filter-chip').forEach(btn => {
            btn.addEventListener('click', () => {
              iotPage.querySelectorAll('.filter-chip').forEach(b => {
                b.classList.remove('active');
                b.setAttribute('aria-pressed', 'false');
              });
              
              btn.classList.add('active');
              btn.setAttribute('aria-pressed', 'true');
              
              allTutorialsFilters.category = btn.dataset.category || 'all';
              allTutorialsFilters.page = 1;
              loadAllTutorials();
            });
          });
        }

        // Load more functionality
        if (loadMoreBtn) {
          loadMoreBtn.addEventListener('click', () => {
            allTutorialsFilters.page++;
            loadAllTutorials({ append: true });
          });
        }

        // Initial load
        loadAllTutorials();
      }



      // Enhanced tutorial search
      let tutorialSearchTimeout;
      if (tutorialSearch) {
        tutorialSearch.addEventListener('input', (e) => {
          clearTimeout(tutorialSearchTimeout);
          tutorialSearchTimeout = setTimeout(() => {
            tFilters.search = e.target.value.trim();
            tFilters.page = 1;
            loadTutorials();
          }, 500);
        });
      }

      // Enhanced tutorial filter buttons
      document.querySelectorAll('.tutorial-filters .filter-chip').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tutorial-filters .filter-chip').forEach(b => {
            b.classList.remove('active');
            b.setAttribute('aria-pressed', 'false');
          });
          
          btn.classList.add('active');
          btn.setAttribute('aria-pressed', 'true');
          
          tFilters.category = btn.dataset.category || 'all';
          tFilters.page = 1;
          loadTutorials();
        });
      });

      // Enhanced Tutorial Details Modal
      function openTutorialModal(tutorialId, title) {
        if (!tutorialModal) return;
        
        tutorialModalTitle.textContent = title || 'Tutorial Deep Dive';
        showLoading(tutorialModalBody, ' Loading comprehensive tutorial content...');
        tutorialModal.classList.add('open');
        closeTutorial?.focus?.();
        
        // Load full tutorial details with enhanced content
        getJSON(`/api/tutorials/${tutorialId}`).then(tutorial => {
          const componentsSection = tutorial.components?.length ? `
            <div style="margin-bottom:28px;">
              <h4 style="margin-bottom:12px;color:var(--brand-navy);display:flex;align-items:center;gap:8px;">
                🔧 Required Components & Hardware
              </h4>
              <div class="component-list">
                ${tutorial.components.map(c => `<span class="component-tag">${c}</span>`).join('')}
              </div>
              <div class="note info" style="margin-top:12px;">
                <strong> Shopping Tip:</strong> Most components are available from local electronics stores or online platforms like Amazon, Flipkart, or specialized IoT retailers.
              </div>
            </div>
          ` : '';

          const architectureSection = tutorial.architecture ? `
            <div style="margin-bottom:28px;">
              <h4 style="margin-bottom:12px;color:var(--brand-navy);display:flex;align-items:center;gap:8px;">
                 System Architecture & Wiring
              </h4>
              <img src="${tutorial.architecture}" alt="System Architecture Diagram" class="architecture-diagram" />
              <div class="note info">
                <strong> Circuit Guide:</strong> Follow the wiring diagram carefully. Double-check connections before powering on your circuit.
              </div>
            </div>
          ` : '';

          const tagsSection = tutorial.tags?.length ? `
            <div style="margin-bottom:20px;">
              <h4 style="margin-bottom:12px;color:var(--brand-navy);display:flex;align-items:center;gap:8px;">
                 Related Topics
              </h4>
              <div style="display:flex;flex-wrap:wrap;gap:8px;">
                ${tutorial.tags.map(tag => `<span class="component-tag">#${tag}</span>`).join('')}
              </div>
            </div>
          ` : '';

          tutorialModalBody.innerHTML = `
            <div style="margin-bottom:24px;">
              <div style="display:flex;gap:16px;align-items:center;margin-bottom:16px;flex-wrap:wrap;">
                <span class="tutorial-difficulty ${difficultyClass(tutorial.difficulty)}">
                  ${(tutorial.difficulty || 'beginner').toUpperCase()}
                </span>
                <span style="font-size:14px;color:var(--muted);display:flex;align-items:center;gap:4px;">
                  ${categoryEmoji(tutorial.category)} ${(tutorial.category || 'sensor').replace('-', ' ').toUpperCase()}
                </span>
                <span style="font-size:14px;color:var(--muted);display:flex;align-items:center;gap:4px;">
                   ${tutorial.estimatedTime || '30 minutes'}
                </span>
              </div>
              
              <div class="note info">
                <h4 style="margin:0 0 8px 0;"> Project Overview</h4>
                <p style="margin:0;line-height:1.6;">${tutorial.description}</p>
              </div>
            </div>
            
            ${componentsSection}
            ${architectureSection}
            
            <div style="margin-bottom:28px;">
              <h4 style="margin-bottom:12px;color:var(--brand-navy);display:flex;align-items:center;gap:8px;">
                💻 Complete Source Code
              </h4>
              <div class="note warning" style="margin-bottom:12px;">
                <strong> Before You Start:</strong> Make sure to install required libraries and verify your board settings in Arduino IDE.
              </div>
              <div class="code-block">${tutorial.codeSnippet}</div>
              <div class="note success">
                <strong>Code Tips:</strong> Copy the code to Arduino IDE, verify the compilation, and upload to your microcontroller. Check serial monitor for debugging output.
              </div>
            </div>
            
            ${tagsSection}
            
            <div style="margin-top:24px;padding-top:20px;border-top:1px solid var(--border);">
              <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;">
                <div style="font-size:14px;color:var(--muted);">
                  <strong> Created by:</strong> ${tutorial.author || 'Knowledge Garden Team'}
                </div>
                <div style="display:flex;gap:8px;">
                  <button class="btn" onclick="window.print()" title="Print tutorial">
                     Print
                  </button>
                  <button class="btn" onclick="navigator.share && navigator.share({title: '${tutorial.title}', text: '${tutorial.description}', url: window.location.href})" title="Share tutorial">
                     Share
                  </button>
                </div>
              </div>
            </div>
          `;
        }).catch(error => {
          console.error('Failed to load tutorial details:', error);
          tutorialModalBody.innerHTML = `
            <div class="note error">
              <h4 style="margin-bottom:8px;"> Failed to Load Tutorial</h4>
              <p>We encountered an error while loading the tutorial details: ${error.message}</p>
              <p>Please try again later or contact our support team if the problem persists.</p>
            </div>
          `;
        });
      }

      function closeTutorialModal() {
        if (tutorialModal) {
          tutorialModal.classList.remove('open');
        }
      }

      // Enhanced modal event handlers
      closeTutorial?.addEventListener('click', closeTutorialModal);
      tutorialModal?.addEventListener('click', (e) => {
        if (e.target === tutorialModal) closeTutorialModal();
      });

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && tutorialModal?.classList.contains('open')) {
          closeTutorialModal();
        }
      });

      // Enhanced delegation for tutorial buttons
      document.addEventListener('click', (e) => {
        const btn = e.target.closest('.view-tutorial-btn');
        if (!btn) return;
        
        e.preventDefault();
        openTutorialModal(btn.dataset.id, btn.dataset.title);
      });

      // ===== ENHANCED JOIN US SYSTEM =====
      const joinModal = document.getElementById('joinModal');
      const openJoinBtn = document.getElementById('openJoin');
      const closeJoin = document.getElementById('closeJoin');
      const cancelJoin = document.getElementById('cancelJoin');
      const submitJoin = document.getElementById('submitJoin');
      const joinMsg = document.getElementById('joinMsg');
      const joinBtnText = document.getElementById('joinBtnText');
      const joinBtnLoader = document.getElementById('joinBtnLoader');

      // Form elements
      const roleEl = document.getElementById('role');
      const fullNameEl = document.getElementById('fullName');
      const emailEl = document.getElementById('email');
      const phoneEl = document.getElementById('phone');
      const extraEl = document.getElementById('extra');
      const messageEl = document.getElementById('message');

      function openModal(modal, focusEl) {
        if (!modal) return () => {};
        
        modal.classList.add('open');
        const focusables = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        (focusEl || focusables[0])?.focus?.();
        
        function onEsc(e) { 
          if (e.key === 'Escape') close(); 
        }
        
        function onBack(e) { 
          if (e.target === modal) close(); 
        }
        
        function close() { 
          modal.classList.remove('open'); 
          modal.removeEventListener('keydown', onEsc); 
          modal.removeEventListener('click', onBack); 
        }
        
        modal.addEventListener('keydown', onEsc); 
        modal.addEventListener('click', onBack);
        return close;
      }

      function showJoinMessage(message, type = 'info') {
        if (!joinMsg) return;
        
        joinMsg.className = `note ${type}`;
        joinMsg.textContent = message;
        joinMsg.style.display = 'block';
      }

      function hideJoinMessage() {
        if (joinMsg) {
          joinMsg.style.display = 'none';
        }
      }

      function setJoinLoading(loading) {
        if (!submitJoin || !joinBtnText || !joinBtnLoader) return;
        
        if (loading) {
          submitJoin.disabled = true;
          joinBtnText.style.display = 'none';
          joinBtnLoader.style.display = 'inline-block';
        } else {
          submitJoin.disabled = false;
          joinBtnText.style.display = 'inline';
          joinBtnLoader.style.display = 'none';
        }
      }

      function validateJoinForm() {
        const errors = [];
        
        if (!roleEl?.value) errors.push('Please select your role');
        if (!fullNameEl?.value?.trim()) errors.push('Full name is required');
        if (!emailEl?.value?.trim()) errors.push('Email address is required');
        
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (emailEl?.value && !emailRegex.test(emailEl.value)) {
          errors.push('Please enter a valid email address');
        }
        
        return errors;
      }

      function resetJoinForm() {
        if (roleEl) roleEl.value = '';
        if (fullNameEl) fullNameEl.value = '';
        if (emailEl) emailEl.value = '';
        if (phoneEl) phoneEl.value = '';
        if (extraEl) extraEl.value = '';
        if (messageEl) messageEl.value = '';
        hideJoinMessage();
      }

           // Enhanced join modal handlers
      if (openJoinBtn) {
        openJoinBtn.addEventListener('click', () => {
          resetJoinForm();
          openModal(joinModal, fullNameEl);
        });
      }

      // Make openModal function globally accessible for project modal integration
      window.openModal = openModal;

      [closeJoin, cancelJoin].forEach(btn => {
        btn?.addEventListener('click', () => {
          joinModal?.classList.remove('open');
        });
      });
      if (submitJoin) {
        submitJoin.addEventListener('click', async () => {
          const errors = validateJoinForm();
          
          if (errors.length > 0) {
            showJoinMessage(`Please fix the following errors:\n• ${errors.join('\n• ')}`, 'error');
            return;
          }

          setJoinLoading(true);
          showJoinMessage('Submitting your application...', 'info');

          try {
            await postJSON('/api/join', {
              role: roleEl?.value,
              fullName: (fullNameEl?.value || '').trim(),
              email: (emailEl?.value || '').trim(),
              phone: (phoneEl?.value || '').trim(),
              extra: (extraEl?.value || '').trim(),
              message: (messageEl?.value || '').trim()
            });

            showJoinMessage('🎉 Welcome to Knowledge Garden! We\'ll contact you soon with next steps.', 'success');
            
            setTimeout(() => {
              joinModal?.classList.remove('open');
              resetJoinForm();
              loadStats(); // Refresh community stats
            }, 2000);

          } catch (error) {
            console.error('Join submission failed:', error);
            showJoinMessage(` Submission failed: ${error.message}. Please try again.`, 'error');
          } finally {
            setJoinLoading(false);
          }
        });
      }

      // ===== ENHANCED STATS SYSTEM =====
      const countEls = {
        learners: document.getElementById('countLearners'),
        mentors: document.getElementById('countMentors'),
        partners: document.getElementById('countPartners')
      };
      const statsMsg = document.getElementById('statsMsg');

      function animateCount(element, targetValue, duration = 1000) {
        if (!element || !isFinite(targetValue)) return;
        
        const startValue = parseInt(element.textContent || '0', 10) || 0;
        const difference = targetValue - startValue;
        const startTime = performance.now();

        function updateCount(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          
          // Easing function for smooth animation
          const easeOut = 1 - Math.pow(1 - progress, 3);
          const currentValue = Math.round(startValue + difference * easeOut);
          
          element.textContent = currentValue.toLocaleString();
          
          if (progress < 1) {
            requestAnimationFrame(updateCount);
          }
        }
        
        requestAnimationFrame(updateCount);
      }

      async function loadStats() {
        if (statsMsg) statsMsg.style.display = 'none';
        
        try {
          const data = await getJSON('/api/stats');
          
          // Animate counters with staggered timing
          setTimeout(() => animateCount(countEls.learners, +data.learners || 0), 100);
          setTimeout(() => animateCount(countEls.mentors, +data.mentors || 0), 300);
          setTimeout(() => animateCount(countEls.partners, +data.partners || 0), 500);
          
        } catch (error) {
          console.error('Failed to load stats:', error);
          if (statsMsg) {
            statsMsg.textContent = `Unable to load community statistics: ${error.message}`;
            statsMsg.className = 'note error';
            statsMsg.style.display = 'block';
          }
        }
      }

            // ===== ENHANCED GALLERY SYSTEM =====
      const galTrack = document.getElementById('galTrack');
      const galError = document.getElementById('galError');

      async function loadGallery() {
        if (galError) galError.style.display = 'none';
        
        try {
          const data = await getJSON('/api/gallery', { limit: 50 });
          
          if (!Array.isArray(data)) {
            throw new Error('Invalid response format received from server');
          }
          
          if (!data.length) {
            if (galTrack) {
              galTrack.innerHTML = `
                <div class="note info" style="display:flex;align-items:center;justify-content:center;min-width:320px;height:200px;text-align:center;">
                  <div>
                    <h4 style="margin-bottom:8px;"> Gallery Coming Soon</h4>
                    <p style="margin:0;">Amazing IoT projects from our community will be showcased here!</p>
                  </div>
                </div>
              `;
            }
            return;
          }

          const createCards = (projects) => projects.map(p => `
            <figure class="card interactive-element gallery-card" 
                    data-project-id="${p._id || p.id}"
                    data-project-title="${(p.title || 'Innovative Project').replace(/"/g, '&quot;')}"
                    data-project-desc="${(p.desc || p.description || 'Amazing IoT innovation from our community').replace(/"/g, '&quot;')}"
                    data-project-authors="${(p.authors || 'Knowledge Garden Team').replace(/"/g, '&quot;')}"
                    data-project-track="${(p.track || 'IoT').replace(/"/g, '&quot;')}"
                    data-project-img="${p.img || '/logo.jpeg'}"
                    data-project-url="${(p.url || '').replace(/"/g, '&quot;')}"
                    style="cursor: pointer;"
                    role="button"
                    tabindex="0"
                    aria-label="View details for ${p.title || 'Innovative Project'}">
              <img src="${p.img || '/logo.jpeg'}" alt="${p.title || 'IoT Project'}" loading="lazy" />
              <figcaption class="cap">
                <div style="font-weight: 600; margin-bottom: 4px;">${p.title || 'Innovative Project'}</div>
                <div style="font-size: 11px; color: rgba(10,46,111,0.7); display: flex; align-items: center; justify-content: space-between;">
                  <span>${p.track ? `${p.track} • ` : ''}${p.authors || 'Knowledge Garden Team'}</span>
                  ${p.url ? '<span style="color: var(--brand-mag);">🔗</span>' : ''}
                </div>
              </figcaption>
            </figure>
          `).join('');
          if (galTrack) {
            const cardsHtml = createCards(data);
            galTrack.innerHTML = cardsHtml + cardsHtml; // Duplicate for seamless loop
          }

        } catch (error) {
          console.error('Failed to load gallery:', error);
          if (galTrack) {
            galTrack.innerHTML = `
              <div class="note error" style="display:flex;align-items:center;justify-content:center;min-width:320px;height:200px;text-align:center;">
                <div>
                  <h4 style="margin-bottom:8px;"> Gallery Unavailable</h4>
                  <p style="margin:0;">Unable to load project gallery: ${error.message}</p>
                </div>
              </div>
            `;
          }
          if (galError) {
            galError.textContent = `Failed to load gallery: ${error.message}`;
            galError.style.display = 'block';
          }
        }
      }

      // ===== PROJECT DETAILS MODAL =====
      const projectModal = document.createElement('div');
      projectModal.className = 'modal';
      projectModal.id = 'projectModal';
      projectModal.setAttribute('aria-modal', 'true');
      projectModal.setAttribute('role', 'dialog');
      projectModal.setAttribute('aria-labelledby', 'projectModalTitle');
      projectModal.innerHTML = `
        <div class="modal-card">
          <div class="modal-head">
            <h3 id="projectModalTitle">Project Details</h3>
            <button class="modal-close" id="closeProject" aria-label="Close project details">&times;</button>
          </div>
          <div class="modal-body" id="projectModalBody">
            <div class="note info">Loading project details...</div>
          </div>
        </div>
      `;
      document.body.appendChild(projectModal);

      const closeProject = document.getElementById('closeProject');

      function openProjectModal(projectData) {
        const projectModalTitle = document.getElementById('projectModalTitle');
        const projectModalBody = document.getElementById('projectModalBody');
        
        if (!projectModal || !projectModalTitle || !projectModalBody) return;
        
        projectModalTitle.textContent = projectData.title || 'Project Details';
        
        const trackIcon = {
          'IoT': '',
          'AI': '',
          'Robotics': '',
          'Web': '',
          'Mobile': ''
        }[projectData.track] || '';

        // Function to get URL type and icon
        function getUrlTypeInfo(url) {
          if (!url || url.trim() === '') return null;
          
          const urlLower = url.toLowerCase().trim();
          if (urlLower.includes('youtube.com') || urlLower.includes('youtu.be')) {
            return { icon: '', type: 'YouTube Video', color: '#ff0000' };
          } else if (urlLower.includes('github.com')) {
            return { icon: '', type: 'GitHub Repository', color: '#333333' };
          } else if (urlLower.includes('docs.google.com')) {
            return { icon: '', type: 'Google Docs', color: '#4285f4' };
          } else if (urlLower.includes('drive.google.com')) {
            return { icon: '', type: 'Google Drive', color: '#34a853' };
          } else if (urlLower.includes('linkedin.com')) {
            return { icon: '', type: 'LinkedIn', color: '#0077b5' };
          } else {
            return { icon: '', type: 'Reference Link', color: 'var(--brand-mag)' };
          }
        }

        // Get URL info and debug
        const projectUrl = projectData.url && projectData.url.trim() !== '' ? projectData.url.trim() : null;
        const urlInfo = getUrlTypeInfo(projectUrl);
        
        console.log('Project URL Debug:', {
          originalUrl: projectData.url,
          processedUrl: projectUrl,
          urlInfo: urlInfo
        });

        projectModalBody.innerHTML = `
          <div style="display: grid; gap: 24px;">
            <!-- Project Image with URL overlay -->
            <div style="text-align: center; position: relative;">
              <img src="${projectData.img || '/logo.jpeg'}" 
                   alt="${projectData.title}" 
                   style="max-width: 100%; height: auto; border-radius: 12px; box-shadow: var(--shadow-lg); max-height: 400px; object-fit: cover; cursor: ${projectUrl ? 'pointer' : 'default'};" 
                   ${projectUrl ? `onclick="window.open('${projectUrl}', '_blank', 'noopener,noreferrer')" title="Click to open reference link"` : ''} />
              ${projectUrl && urlInfo ? `
                <div style="position: absolute; top: 12px; right: 12px; background: rgba(0,0,0,0.8); color: white; padding: 8px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                  ${urlInfo.icon} Click to open
                </div>
              ` : ''}
            </div>
            
            <!-- Project Info -->
            <div style="display: grid; gap: 20px;">
              <!-- Title and Track -->
              <div>
                <h3 style="margin: 0 0 8px 0; color: var(--brand-navy); font-size: 24px; font-weight: 700;">
                  ${projectData.title}
                </h3>
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
                  <span class="component-tag" style="background: linear-gradient(135deg, var(--brand-navy), var(--brand-mag)); color: white; font-weight: 600;">
                    ${trackIcon} ${projectData.track} Project
                  </span>
                  ${projectUrl && urlInfo ? `
                    <a href="${projectUrl}" target="_blank" rel="noopener noreferrer" 
                       class="component-tag" 
                       style="background: ${urlInfo.color}; color: white; text-decoration: none; font-weight: 600; transition: all 0.3s ease;"
                       onmouseover="this.style.transform='scale(1.05)'" 
                       onmouseout="this.style.transform='scale(1)'">
                      ${urlInfo.icon} ${urlInfo.type}
                    </a>
                  ` : ''}
                </div>
              </div>
              
              <!-- Description -->
              <div>
                <h4 style="margin: 0 0 12px 0; color: var(--brand-navy); display: flex; align-items: center; gap: 8px;">
                   Project Description
                </h4>
                <div class="note info">
                  <p style="margin: 0; line-height: 1.6; font-size: 16px;">
                    ${projectData.desc || 'This innovative project showcases cutting-edge technology and creative problem-solving in the field of ' + (projectData.track || 'Internet of Things') + '. Developed by talented innovators, it demonstrates practical applications and real-world solutions.'}
                  </p>
                </div>
              </div>

              <!-- Authors and Track Info -->
              <div style="display: grid; gap: 16px;">
                <div>
                  <h4 style="margin: 0 0 8px 0; color: var(--brand-navy); display: flex; align-items: center; gap: 8px;">
                     Created By
                  </h4>
                  <div style="background: #f8fafc; padding: 12px; border-radius: 8px; border-left: 4px solid var(--brand-navy);">
                    <p style="margin: 0; font-weight: 600; color: var(--brand-navy);">
                      ${projectData.authors || 'Knowledge Garden Community'}
                    </p>
                  </div>
                </div>
                <div>
                  <h4 style="margin: 0 0 8px 0; color: var(--brand-navy); display: flex; align-items: center; gap: 8px;">
                    🔧 Technology Track
                  </h4>
                  <div style="background: #f8fafc; padding: 12px; border-radius: 8px; border-left: 4px solid var(--brand-mag);">
                    <p style="margin: 0; font-weight: 600; color: var(--brand-navy);">
                      ${trackIcon} ${projectData.track || 'Internet of Things'}
                    </p>
                  </div>
                </div>
              </div>

              ${projectUrl && urlInfo ? `
                <!-- Reference Link Section -->
                <div>
                  <h4 style="margin: 0 0 12px 0; color: var(--brand-navy); display: flex; align-items: center; gap: 8px;">
                     Project Resources
                  </h4>
                  <div style="background: #f0f9ff; padding: 16px; border-radius: 12px; border-left: 4px solid #0ea5e9;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                      <span style="font-size: 24px;">${urlInfo.icon}</span>
                      <div>
                        <strong style="color: var(--brand-navy); font-size: 16px;">${urlInfo.type}</strong>
                        <p style="margin: 4px 0 0 0; color: var(--muted); font-size: 14px;">Click to explore additional project resources and documentation</p>
                      </div>
                    </div>
                    <a href="${projectUrl}" target="_blank" rel="noopener noreferrer" 
                       style="display: inline-flex; align-items: center; gap: 8px; background: linear-gradient(135deg, var(--brand-navy), var(--brand-mag)); color: white; text-decoration: none; padding: 10px 16px; border-radius: 8px; font-weight: 600; transition: all 0.3s ease;"
                       onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='var(--shadow-md)'" 
                       onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                      <span></span> Open Reference Link
                    </a>
                  </div>
                </div>
              ` : ''}
              
              <!-- Key Features -->
              <div>
                <h4 style="margin: 0 0 12px 0; color: var(--brand-navy); display: flex; align-items: center; gap: 8px;">
                   Key Features & Highlights
                </h4>
                <div style="display: grid; gap: 8px;">
                  <div style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid var(--success);">
                    <span></span>
                    <span>Innovative ${projectData.track || 'IoT'} solution design</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid var(--success);">
                    <span></span>
                    <span>Real-world practical applications</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid var(--success);">
                    <span></span>
                    <span>Community-driven development approach</span>
                  </div>
                </div>
              </div>

              <!-- Call to Action -->
              <div style="background: linear-gradient(135deg, #f8fafc, #ffffff); padding: 20px; border-radius: 12px; border: 1px solid var(--border); text-align: center;">
                <h4 style="margin: 0 0 8px 0;"> Inspired by this project?</h4>
                <p style="margin: 0;">
                  Join our community to start building your own innovative IoT solutions! 
                  <a href="#" onclick="handleJoinFromProject(event)" 
                     style="color: var(--brand-mag); font-weight: 600; text-decoration: none;">
                    Get started today →
                  </a>
                </p>
              </div>
            </div>
          </div>
        `;
        
        projectModal.classList.add('open');
        closeProject?.focus?.();
      }

      function closeProjectModal() {
        if (projectModal) {
          projectModal.classList.remove('open');
        }
      }

      // Enhanced modal event handlers
      closeProject?.addEventListener('click', closeProjectModal);
      projectModal?.addEventListener('click', (e) => {
        if (e.target === projectModal) closeProjectModal();
      });

      // Enhanced gallery card click handlers
            // Enhanced gallery card click handlers
      document.addEventListener('click', (e) => {
        const galleryCard = e.target.closest('.gallery-card');
        if (!galleryCard) return;
        
        e.preventDefault();
        
        const projectData = {
          id: galleryCard.dataset.projectId,
          title: galleryCard.dataset.projectTitle,
          desc: galleryCard.dataset.projectDesc,
          authors: galleryCard.dataset.projectAuthors,
          track: galleryCard.dataset.projectTrack,
          img: galleryCard.dataset.projectImg,
          url: galleryCard.dataset.projectUrl
        };
        
        openProjectModal(projectData);
      });

      // Add handler for join from project modal
      window.handleJoinFromProject = function(event) {
        event.preventDefault();
        event.stopPropagation();
        
        try {
          // Close the project modal first
          closeProjectModal();
          
          // Small delay to ensure modal closes before opening join modal
          setTimeout(() => {
            // Scroll to home section
            const homeSection = document.getElementById('home');
            if (homeSection) {
              homeSection.scrollIntoView({ behavior: 'smooth' });
            }
            
            // Open the join modal
            const openJoinBtn = document.getElementById('openJoin');
            if (openJoinBtn) {
              openJoinBtn.click();
            } else {
              // Fallback: directly open the join modal
              const joinModal = document.getElementById('joinModal');
              const fullNameEl = document.getElementById('fullName');
              if (joinModal) {
                openModal(joinModal, fullNameEl);
              }
            }
          }, 300);
          
        } catch (error) {
          console.error('Error opening join modal from project:', error);
          
          // Show user-friendly error notification following the error handling protocol
          const errorNotification = document.createElement('div');
          errorNotification.className = 'note error';
          errorNotification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            max-width: 400px;
            box-shadow: var(--shadow-lg);
            animation: slideIn 0.3s ease;
          `;
          errorNotification.innerHTML = `
            <strong> Unable to open join form</strong><br>
            Please try clicking the "Join Our Community" button in the main section.
            <button onclick="this.parentElement.remove()" 
                    style="float:right;background:none;border:none;color:inherit;cursor:pointer;margin-left:8px;font-size:18px;">&times;</button>
          `;
          
          document.body.appendChild(errorNotification);
          
          // Auto-dismiss after 8 seconds as per error handling protocol
          setTimeout(() => {
            if (errorNotification.parentNode) {
              errorNotification.remove();
            }
          }, 8000);
        }
      };

      // Enhanced keyboard navigation for gallery cards
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          const galleryCard = e.target.closest('.gallery-card');
          if (galleryCard) {
            e.preventDefault();
            galleryCard.click();
          }
        }
        
        if (e.key === 'Escape' && projectModal?.classList.contains('open')) {
          closeProjectModal();
        }
      });



      
     

      // ===== NOTIFICATION DETAILS MODAL =====
      const notifModal = document.getElementById('notifModal');
      const notifTitle = document.getElementById('notifTitle');
      const notifBody = document.getElementById('notifBody');
      const closeNotif = document.getElementById('closeNotif');

      function openNotifModal(notification) {
        if (!notifModal) return;
        
        notifTitle.textContent = notification.title || 'Event Details';
        
        const categoryIcon = {
          event: '',
          workshop: '', 
          competition: ''
        }[notification.cat] || '';

        notifBody.innerHTML = `
          <div class="note info" style="margin-bottom:20px;">
            <h4 style="margin:0 0 8px 0;display:flex;align-items:center;gap:8px;">
              ${categoryIcon} ${(notification.cat || 'event').toUpperCase()}
            </h4>
            <p style="margin:0;">${notification.title}</p>
          </div>
          
          <div style="display:grid;gap:16px;">
            <div>
              <strong style="color:var(--brand-navy);display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                 Date & Time
              </strong>
              <p style="margin:0;color:var(--muted);">${fmtDate(notification.when)}</p>
            </div>
            
            ${notification.venue ? `
              <div>
                <strong style="color:var(--brand-navy);display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                   Venue
                </strong>
                <p style="margin:0;color:var(--muted);">${notification.venue}</p>
              </div>
            ` : ''}
          </div>
          
          <div class="note success" style="margin-top:20px;">
            <strong>Interested?</strong> Contact us at <a href="mailto:knowledgegarden@egspec.org">knowledgegarden@egspec.org</a> for more information or to register.
          </div>
        `;
        
        notifModal.classList.add('open');
        closeNotif?.focus?.();
      }

      function closeNotifModal() {
        if (notifModal) {
          notifModal.classList.remove('open');
        }
      }

      closeNotif?.addEventListener('click', closeNotifModal);
      notifModal?.addEventListener('click', (e) => {
        if (e.target === notifModal) closeNotifModal();
      });

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && notifModal?.classList.contains('open')) {
          closeNotifModal();
        }
      });

      // Enhanced delegation for notification details
      document.addEventListener('click', (e) => {
        const btn = e.target.closest('.details-btn');
        if (!btn) return;
        
        e.preventDefault();
        openNotifModal({
          id: btn.dataset.id,
          title: btn.dataset.title,
          when: btn.dataset.when,
          venue: btn.dataset.venue,
          cat: btn.dataset.cat
        });
      });

      // ===== INITIALIZATION & ERROR HANDLING =====
      
      // Enhanced offline detection
      function handleOffline() {
        const offlineNotice = document.createElement('div');
        offlineNotice.className = 'note warning';
        offlineNotice.style.position = 'fixed';
        offlineNotice.style.top = '20px';
        offlineNotice.style.left = '20px';
        offlineNotice.style.right = '20px';
        offlineNotice.style.zIndex = '9999';
        offlineNotice.innerHTML = ' <strong>You\'re offline.</strong> Some features may not work until connection is restored.';
        document.body.appendChild(offlineNotice);
        
        setTimeout(() => offlineNotice.remove(), 5000);
      }

            function handleOnline() {
        const onlineNotice = document.createElement('div');
        onlineNotice.className = 'note success';
        onlineNotice.style.position = 'fixed';
        onlineNotice.style.top = '20px';
        onlineNotice.style.left = '20px';
        onlineNotice.style.right = '20px';
        onlineNotice.style.zIndex = '9999';
        onlineNotice.innerHTML = ' <strong>Connection restored!</strong> All features are now available.';
        document.body.appendChild(onlineNotice);
        
        setTimeout(() => onlineNotice.remove(), 3000);
      }

      window.addEventListener('offline', handleOffline);
      window.addEventListener('online', handleOnline);

      // Enhanced error boundary
      window.addEventListener('error', (e) => {
        console.error('Global error:', e.error);
        
        const errorNotice = document.createElement('div');
        errorNotice.className = 'note error';
        errorNotice.style.position = 'fixed';
        errorNotice.style.bottom = '20px';
        errorNotice.style.right = '20px';
        errorNotice.style.maxWidth = '400px';
        errorNotice.style.zIndex = '9999';
        errorNotice.innerHTML = `
          <strong> Something went wrong</strong><br>
          Please refresh the page if issues persist.
          <button onclick="this.parentElement.remove()" style="float:right;background:none;border:none;color:inherit;cursor:pointer;margin-left:8px;">&times;</button>
        `;
        document.body.appendChild(errorNotice);
        
        setTimeout(() => errorNotice.remove(), 8000);
      });

      // Performance monitoring
      function logPerformance() {
        if ('performance' in window) {
          const navigation = performance.getEntriesByType('navigation')[0];
          if (navigation) {
            console.info('Page load performance:', {
              'DOM Content Loaded': Math.round(navigation.domContentLoadedEventEnd - navigation.navigationStart),
              'Page Load Complete': Math.round(navigation.loadEventEnd - navigation.navigationStart),
              'First Paint': Math.round(navigation.responseStart - navigation.navigationStart)
            });
          }
        }
      }

      // Enhanced accessibility features
      function enhanceAccessibility() {
        // Add skip links functionality
        const skipLink = document.querySelector('.skip-link');
        if (skipLink) {
          skipLink.addEventListener('click', (e) => {
            e.preventDefault();
            const target = document.querySelector(skipLink.getAttribute('href'));
            if (target) {
              target.focus();
              target.scrollIntoView({ behavior: 'smooth' });
            }
          });
        }

        // Enhanced keyboard navigation for modals
        document.addEventListener('keydown', (e) => {
          const openModal = document.querySelector('.modal.open');
          if (!openModal) return;

          if (e.key === 'Tab') {
            const focusableElements = openModal.querySelectorAll(
              'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];

            if (e.shiftKey) {
              if (document.activeElement === firstElement) {
                e.preventDefault();
                lastElement.focus();
              }
            } else {
              if (document.activeElement === lastElement) {
                e.preventDefault();
                firstElement.focus();
              }
            }
          }
        });

        // Add ARIA live regions for dynamic content
        const liveRegion = document.createElement('div');
        liveRegion.setAttribute('aria-live', 'polite');
        liveRegion.setAttribute('aria-atomic', 'true');
        liveRegion.style.position = 'absolute';
        liveRegion.style.left = '-10000px';
        liveRegion.style.width = '1px';
        liveRegion.style.height = '1px';
        liveRegion.style.overflow = 'hidden';
        document.body.appendChild(liveRegion);

        window.announceToScreenReader = (message) => {
          liveRegion.textContent = message;
          setTimeout(() => {
            liveRegion.textContent = '';
          }, 1000);
        };
      }

      // Enhanced smooth scrolling for navigation
      function enhanceSmoothScrolling() {
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
          anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
              const headerOffset = 80;
              const elementPosition = target.getBoundingClientRect().top;
              const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

              window.scrollTo({
                top: offsetPosition,
                behavior: 'smooth'
              });

              // Announce navigation for screen readers
              if (window.announceToScreenReader) {
                window.announceToScreenReader(`Navigated to ${target.querySelector('h1, h2, h3')?.textContent || 'section'}`);
              }
            }
          });
        });
      }

      // Advanced lazy loading for images
      function enhanceLazyLoading() {
        if ('IntersectionObserver' in window) {
          const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                const img = entry.target;
                if (img.dataset.src) {
                  img.src = img.dataset.src;
                  img.removeAttribute('data-src');
                }
                img.classList.add('loaded');
                observer.unobserve(img);
              }
            });
          }, {
            rootMargin: '50px 0px',
            threshold: 0.01
          });

          document.querySelectorAll('img[data-src]').forEach(img => {
            imageObserver.observe(img);
          });
        }
      }

      // Enhanced loading states
      function createLoadingSpinner(size = 'medium') {
        const spinner = document.createElement('div');
        spinner.className = 'loading-spinner';
        spinner.style.cssText = `
          display: inline-block;
          width: ${size === 'small' ? '16px' : size === 'large' ? '32px' : '24px'};
          height: ${size === 'small' ? '16px' : size === 'large' ? '32px' : '24px'};
          border: 2px solid rgba(10,46,111,0.1);
          border-radius: 50%;
          border-top-color: var(--brand-navy);
          animation: spin 1s ease-in-out infinite;
        `;
        return spinner;
      }

      // Enhanced form validation
      function enhanceFormValidation() {
        const forms = document.querySelectorAll('form, .modal-body');
        
        forms.forEach(form => {
          const inputs = form.querySelectorAll('input, select, textarea');
          
          inputs.forEach(input => {
            input.addEventListener('blur', validateInput);
            input.addEventListener('input', clearValidationError);
          });
        });

        function validateInput(e) {
          const input = e.target;
          const value = input.value.trim();
          
          clearValidationError(e);
          
          if (input.hasAttribute('required') && !value) {
            showInputError(input, 'This field is required');
            return false;
          }
          
          if (input.type === 'email' && value) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(value)) {
              showInputError(input, 'Please enter a valid email address');
              return false;
            }
          }
          
          if (input.type === 'tel' && value) {
            const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/;
            if (!phoneRegex.test(value.replace(/\s/g, ''))) {
              showInputError(input, 'Please enter a valid phone number');
              return false;
            }
          }
          
          return true;
        }

        function showInputError(input, message) {
          input.style.borderColor = 'var(--error)';
          
          let errorElement = input.parentNode.querySelector('.input-error');
          if (!errorElement) {
            errorElement = document.createElement('div');
            errorElement.className = 'input-error';
            errorElement.style.cssText = `
              color: var(--error);
              font-size: 12px;
              margin-top: 4px;
              display: block;
            `;
            input.parentNode.appendChild(errorElement);
          }
          
          errorElement.textContent = message;
        }

        function clearValidationError(e) {
          const input = e.target;
          input.style.borderColor = '';
          
          const errorElement = input.parentNode.querySelector('.input-error');
          if (errorElement) {
            errorElement.remove();
          }
        }
      }

      // Enhanced search functionality with debouncing
      function createDebouncedSearch(callback, delay = 500) {
        let timeoutId;
        return function (...args) {
          clearTimeout(timeoutId);
          timeoutId = setTimeout(() => callback.apply(this, args), delay);
        };
      }

      // Enhanced analytics and user behavior tracking
      function initializeAnalytics() {
        // Track page views
        if ('performance' in window && 'PerformanceObserver' in window) {
          // Track Core Web Vitals
          const observer = new PerformanceObserver((list) => {
            for (const entry of list.getEntries()) {
              console.info('Performance metric:', entry.name, entry.value);
            }
          });
          
          observer.observe({ entryTypes: ['measure', 'navigation'] });
        }

        // Track user interactions
        const trackInteraction = (action, category, label) => {
          console.info('User interaction:', { action, category, label, timestamp: new Date().toISOString() });
        };

        // Track button clicks
        document.addEventListener('click', (e) => {
          const button = e.target.closest('button, .btn');
          if (button) {
            trackInteraction('click', 'button', button.textContent?.trim() || 'unknown');
          }
        });

        // Track tutorial views
        document.addEventListener('click', (e) => {
          const tutorialBtn = e.target.closest('.view-tutorial-btn');
          if (tutorialBtn) {
            trackInteraction('view', 'tutorial', tutorialBtn.dataset.title || 'unknown');
          }
        });

        // Track modal opens
        const originalOpenModal = openModal;
        window.openModal = function(modal, focusEl) {
          trackInteraction('open', 'modal', modal?.id || 'unknown');
          return originalOpenModal(modal, focusEl);
        };
      }

      // Progressive Web App features
      function initializePWA() {
        // Service worker registration (if available)
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
              .then(registration => {
                console.log('ServiceWorker registered:', registration);
              })
              .catch(error => {
                console.log('ServiceWorker registration failed:', error);
              });
          });
        }

        // Add to home screen prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
          e.preventDefault();
          deferredPrompt = e;
          
          const installButton = document.createElement('button');
          installButton.textContent = '📱 Install App';
          installButton.className = 'btn';
          installButton.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--brand-navy);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
          `;
          
          installButton.addEventListener('click', () => {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then(choiceResult => {
              if (choiceResult.outcome === 'accepted') {
                console.log('User accepted the install prompt');
              }
              deferredPrompt = null;
              installButton.remove();
            });
          });
          
          document.body.appendChild(installButton);
        });
      }

      // Enhanced theme management
      function initializeThemeManagement() {
        const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
        
        function updateTheme(isDark) {
          if (isDark) {
            document.documentElement.style.setProperty('--bg', '#0f172a');
            document.documentElement.style.setProperty('--text', '#f1f5f9');
            document.documentElement.style.setProperty('--panel', '#1e293b');
            document.documentElement.style.setProperty('--border', '#334155');
          } else {
            document.documentElement.style.setProperty('--bg', '#fff');
            document.documentElement.style.setProperty('--text', '#1f2937');
            document.documentElement.style.setProperty('--panel', '#fff');
            document.documentElement.style.setProperty('--border', '#e5e7eb');
          }
        }
        
        prefersDarkScheme.addEventListener('change', (e) => {
          updateTheme(e.matches);
        });
        
        // Apply initial theme
        updateTheme(prefersDarkScheme.matches);
      }

      // Auto-refresh data functionality
      function initializeAutoRefresh() {
        const refreshInterval = 5 * 60 * 1000; // 5 minutes
        
        setInterval(() => {
          if (!document.hidden && navigator.onLine) {
            console.log('Auto-refreshing data...');
            loadStats();
            // Only refresh notifications if not filtered
            if (nFilters.search === '' && nFilters.cat === 'all' && !nFilters.today) {
              loadNotices();
            }
          }
        }, refreshInterval);
      }

      // Initialize all enhancements
      function initializeApplication() {
        try {
          enhanceAccessibility();
          enhanceSmoothScrolling();
          enhanceLazyLoading();
          enhanceFormValidation();
          initializeAnalytics();
          initializePWA();
          initializeThemeManagement();
          initializeAutoRefresh();
          
          // Initial data loads
          document.querySelectorAll('.section-box').forEach(section => {
            section.classList.add('visible');
          });
          
          Promise.all([
            loadNotices(),
            loadTutorials(),
            loadGallery(),
            loadStats()
          ]).then(() => {
            console.log(' Knowledge Garden initialized successfully');
            logPerformance();
          }).catch(error => {
            console.error(' Initialization error:', error);
          });
          
        } catch (error) {
          console.error('Fatal initialization error:', error);
        }
      }

      // Start the application
      initializeApplication();
    });
    
  </script>
</body>
</html>
